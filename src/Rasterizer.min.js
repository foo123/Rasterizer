/**
*   Rasterizer
*   rasterize, draw and fill lines, rectangles and curves
*
*   @version 0.9.0
*   https://github.com/foo123/Rasterizer
*
**/
!function(r,n,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(r):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.call(r)}):n in r||(r[n]=e.call(r)||1)&&"function"==typeof define&&define.amd&&define(function(){return r[n]})}("undefined"!=typeof self?self:this,"Rasterizer",function(n){"use strict";var r=Object.defineProperty,Y=Math,w=Y.PI,e=1e-6,t=Y.sqrt(2),B=20,S=1,u="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:"undefined"!=typeof Uint8Array?Uint8Array:Array;function f(h,p,g){var b=this;if(!(b instanceof f))return new f(h,p,g);var o=f.getRGBAFrom([0,0,0,1]),i=f.getRGBAFrom([0,0,0,1]),q=new u(h*p<<2),l="butt",a="miter",A=1,R=[],k=function(n,r,e){var t,u;0<=n&&n<h&&0<=r&&r<p&&0<e&&0<(u=3<(t=o(n,r)).length?t[3]:1)&&s(q,h,p,n,r,t[0],t[1],t[2],u*e)},c=function(n,r,e){var t,u;0<=n&&n<h&&0<=r&&r<p&&0<e&&0<(u=3<(t=i(n,r)).length?t[3]:1)&&s(q,h,p,n,r,t[0],t[1],t[2],u*e)};r(b,"strokeStyle",{get:function(){return""},set:function(n){o=f.getRGBAFrom(n)}}),r(b,"fillStyle",{get:function(){return""},set:function(n){i=f.getRGBAFrom(n)}}),r(b,"lineWidth",{get:function(){return A},set:function(n){0<(n=Y.abs(+n||0))&&(A=n)}}),r(b,"lineCap",{get:function(){return l},set:function(n){n=String(n).toLowerCase(),-1!==["butt","square"].indexOf(n)?l=n:y('"'+n+'" lineCap is not supported!')}}),r(b,"lineJoin",{get:function(){return a},set:function(n){n=String(n).toLowerCase(),-1!==["miter","bevel"].indexOf(n)?a=n:y('"'+n+'" lineJoin is not supported!')}}),r(b,"lineDash",{get:function(){return R.slice()},set:function(n){1&(n=[].concat(n)).length&&(n=n.concat(n)),R=n}}),b.setLineDash=function(n){b.lineDash=n},b.strokeRect=function(n,r,e,t){return 1<=e&&1<=t&&0<A&&(G(q),C(k,[n,r,n+e-1,r,n+e-1,r+t-1,n,r+t-1,n,r],A,0,"butt","miter",0,0,h-1,p-1),F(q,h,p,g)),b},b.fillRect=function(n,r,e,t){var u,o,i,f,l,a;return 1<=e&&1<=t&&(G(q),u=c,e=(n=n)+e-1,t=(r=r)+t-1,i=o=0,f=h-1,l=p-1,a=Y.min(n,e),n=Y.max(n,e),e=Y.min(r,t),r=Y.max(r,t),o<n&&a<f&&i<r&&e<l&&((a<o||f<n||e<i||l<r)&&(a=Y.max(a,o),e=Y.max(e,i),n=Y.min(n,f),r=Y.min(r,l)),D(u,Y.round(a),Y.round(e),Y.round(n),Y.round(r))),F(q,h,p,g)),b},b.strokePolyline=function(){return 0<A&&(G(q),C(k,arguments,A,0,l,a,0,0,h-1,p-1),F(q,h,p,g)),b},b.strokeArc=function(n,r,e,t,u,o,i,f){var l,a,c,y,s,x,d,m,v;return 0<A&&(f=f?(d=-i-w,o):(d=o,i),G(q),o=k,l=n,a=r,c=e,y=t,i=u,s=d,x=f,n=A,r=R,t=e=0,u=h-1,d=p-1,m=Y.cos(i),v=Y.sin(i),C(o,O(function(n){var n=s+n*(x-s),r=c*Y.cos(n),n=y*Y.sin(n);return[l+m*r-v*n,a+v*r+m*n]},B,S,!0),n,0,"butt","bevel",e,t,u,d),F(q,h,p,g)),b},b.strokeBezier=function(){var i,n,r,e,t,u,o,f;return 0<A&&4<=arguments.length&&(G(q),4===arguments.length?C(k,arguments,A,0,l,a,0,0,h-1,p-1):(n=A,r=R,e=l,u=t=0,o=h-1,f=p-1,C(k,O(6<(i=arguments).length?function(n){var r=1-n,e=n*n,t=r*r,u=t*r,o=e*n,t=3*t*n,n=3*e*r;return[u*i[0]+t*i[2]+n*i[4]+o*i[6],u*i[1]+t*i[3]+n*i[5]+o*i[7]]}:function(n){var r=1-n,e=r*r,r=2*r*n,n=n*n;return[e*i[0]+r*i[2]+n*i[4],e*i[1]+r*i[3]+n*i[5]]},B,S,!0),n,0,e,"bevel",t,u,o,f)),F(q,h,p,g)),b}}function C(U,n,z,E,r,J,N,j,W,M){var e,t,u,o,i,T,V,H,K,f,l,Q,a,c,y,s,x,d,m,v,h,p,g,b,q,A,R,k,X,w,B,S,C,D,G,F,L,O,P,I=n.length;if(I<6)Z(U,t=n[0],u=n[1],o=n[2],i=n[3],f=Y.abs(o-t),l=Y.abs(i-u),(a=$(z,f,l))[0],a[1],r,r,N,j,W,M);else for(I-=2,e=0;e<I;e+=2)Z(U,t=n[e],u=n[e+1],o=n[e+2],i=n[e+3],f=Y.abs(o-t),l=Y.abs(i-u),(a=$(z,f,l))[0],a[1],0===e?r:null,I===e+2?r:null,N,j,W,M),1<z&&0<e&&(c=U,y=T,s=V,x=t,d=u,m=o,v=i,h=H,p=K,g=Q[0],b=Q[1],q=f,A=l,R=a[0],k=a[1],X=J,w=N,B=j,S=W,C=M,P=O=L=F=G=D=void 0,en(p*q,A*h)||(x<y&&m<x&&(P=y,y=m,m=P,P=s,s=v,v=P,P=h,h=q,q=P,P=p,p=A,A=P,P=g,g=R,R=P,P=b,b=k,k=P),b={x:y-(q=(h=x<y?-1:1)*g),y:s+(g=(A=d<s?-1:1)*b)},y={x:y+q,y:s-g},s={x:x-q,y:d+g},q={x:x+q,y:d-g},G={x:x-(R=(g=m<x?-1:1)*R),y:d+(k=(D=v<d?-1:1)*k)},F={x:x+R,y:d-k},L={x:m-R,y:v+k},m={x:m+R,y:v-k},R={x:x,y:d},v=h==g?A==D?0===p?(O=q,F):(O=s,G):(O=s,F):(O=q,G),"bevel"===X&&(rn(c,O.x,O.y,v.x,v.y),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,w,B,S,C)),"miter"===X&&(P=h==g?A==D?0===p?_(y.x,y.y,q.x,q.y,F.x,F.y,m.x,m.y):_(b.x,b.y,s.x,s.y,G.x,G.y,L.x,L.y):_(b.x,b.y,s.x,s.y,F.x,F.y,m.x,m.y):_(y.x,y.y,q.x,q.y,G.x,G.y,L.x,L.y),rn(c,O.x,O.y,P.x,P.y),rn(c,v.x,v.y,P.x,P.y),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,w,B,S,C),nn(c,P.x,P.y,O.x,O.y,v.x,v.y,w,B,S,C)))),T=t,V=u,H=f,K=l,Q=a}function Z(n,r,e,t,u,o,i,f,l,a,c,y,s,x,d){var m,v=Y.min(r,t),h=Y.max(r,t),p=Y.min(e,u),g=Y.max(e,u);if(y<h&&v<x&&s<g&&p<d){if(v<y||x<h||p<s||d<g){var v=function(n,r,e,t,u,o,i,f){var e=-(e-n),l=-e,t=-(t-r),a=-t,u=n-u,i=i-n,o=r-o,f=f-r,c=1,y=0;if(!(0==e&&u<0||0==l&&i<0||0==t&&o<0||0==a&&f<0||(0!=e&&(u=u/e,i=i/l,e<0?(y<u&&(y=u),i<c&&(c=i)):(y<i&&(y=i),u<c&&(c=u))),0!=t&&(e=o/t,i=f/a,t<0?(y<e&&(y=e),i<c&&(c=i)):(y<i&&(y=i),e<c&&(c=e))),c<y)))return[n+l*y,r+a*y,n+l*c,r+a*c]}(r,e,t,u,y,s,x,d);if(!v)return;en(r,v[0])&&en(e,v[1])||(a=null),en(t,v[2])&&en(u,v[3])||(c=null),r=v[0],e=v[1],t=v[2],u=v[3]}0===f&&0===l?rn(n,r,e,t,u,o,i):(h=n,p=e,g=u,y=i,s=f,x=l,d=a,v=c,(n=t)<(e=r)&&(m=e,e=n,n=m,m=p,p=g,g=m,m=d,d=v,v=m),m=g<p?-1:1,L(u=o,0)?("square"===d&&(p-=m*s),"square"===v&&(g+=m*s),D(h,Y.round(e-s),Y.round(p),Y.round(e+s),Y.round(g))):L(y,0)?("square"===d&&(e-=+x),"square"===v&&(n+=+x),D(h,Y.round(e),Y.round(p-x),Y.round(n),Y.round(p+x))):("square"===d&&(e-=+x,p-=m*s),"square"===v&&(n+=+x,g+=m*s),d={x:n-(u=+s),y:g+(y=m*x)},v={x:n+u,y:g-y},rn(h,(s={x:e-u,y:p+y}).x,s.y,(m={x:e+u,y:p-y}).x,m.y),rn(h,m.x,m.y,v.x,v.y),rn(h,v.x,v.y,d.x,d.y),rn(h,d.x,d.y,s.x,s.y),nn(h,s.x,s.y,m.x,m.y,d.x,d.y),nn(h,m.x,m.y,d.x,d.y,v.x,v.y)))}}function $(n,r,e){return n<=1?[0,0]:L(r,0)?[(n-1)/2,0]:L(e,0)?[0,(n-1)/2]:[e*(n=(n-1)/2)/(e=l(r,e)),r*n/e]}function _(n,r,e,t,u,o,i,f){var l=t-r,a=n-e,e=e*r-n*t,r=f-o,n=u-i,t=i*o-u*f,i=l*n-a*r;return!en(i,0)&&{x:(a*t-e*n)/i,y:(e*r-l*t)/i}}function D(n,r,e,t,u){var o,i;if(t<r&&(o=r,r=t,t=o),u<e&&(i=e,e=u,u=i),e===u)for(o=r;o<=t;++o)n(o,e,1);else if(r===t)for(i=e;i<=u;++i)n(r,i,1);else for(i=e;i<=u;++i)for(o=r;o<=t;++o)n(o,i,1)}function nn(n,r,e,t,u,o,i,f,l,a,c){var y,s,x,d,m,v,h,p,g,b,q,A,R,k,w=null!=f;if(u<e&&(x=e,e=u,u=x,x=r,r=t,t=x),i<e&&(x=e,e=i,i=x,x=r,r=o,o=x),i<u&&(x=u,u=i,i=x,x=t,t=o,o=x),L(b=i-e,0))return d=Y.round(e),D(n,y=Y.round(Y.min(r,t,o)),d,s=Y.round(Y.max(r,t,o)),d);for(A=i-u,h=o-r,p=t-r,g=o-t,R=L(q=u-e,0),k=L(A,0),d=Y.round(e+.5),m=Y.round(u),v=Y.round(i-.5),w&&(d=Y.max(l,d),v=Y.min(c,v));d<=v;++d)if(s=d<m?R?(y=r,t):(y=h*(d-e)/b+r,p*(d-e)/q+r):k?(y=t,o):(y=h*(d-e)/b+r,g*(d-u)/A+t),!en(y,s))for(s<y&&(x=y,y=s,s=x),y=Y.round(y+.5),s=Y.round(s-.5),w&&(y=Y.max(f,y),s=Y.min(a,s));y<=s;++y)n(y,d,1)}function rn(n,r,e,t,u,o,i){if(null==o&&(o=Y.abs(t-r),i=Y.abs(u-e)),L(o,0)||L(i,0))return D(n,Y.round(r),Y.round(e),Y.round(t),Y.round(u));var f,l,a,c,y,s=0,x=0,d=0,m=0,v=0,h=0,p=0;if(t<r&&(f=r,r=t,t=f,l=e,e=u,u=l),y=u<e?-1:1,f=r,l=e,a=t,c=u,r=Y.round(f),e=Y.round(l),t=Y.round(a),u=Y.round(c),o<i)for(x=f+(s=+o/i),v=1-(l+.5-e),h=1-(c+.5-u),m=1-(d=f-r),f=r,l=e,d*=v,m*=v;;){if(0<m&&n(f,l,m),0<d&&n(f+1,l,d),l===u)return;m=1-(d=x-(p=Y.floor(x))),(l+=y)===u?(f=t,d*=h,m*=h):f=p,x+=s}else for(x=l+(s=y*i/o),v=1-(f+.5-r),h=1-(a+.5-t),m=1-(d=l-e),f=r,l=e,d*=v,m*=v;;){if(0<m&&n(f,l,m),0<d&&n(f,l+1,d),f===t)return;m=1-(d=x-(p=Y.floor(x))),(f+=1)===t?(l=u,d*=h,m*=h):l=p,x+=s}}function y(n){throw new Error(n)}function G(n){if(n.fill)n.fill(0);else for(var r=0,e=n.length;r<e;++r)n[r]=0}function s(n,r,e,t,u,o,i,f,l){var a;0<=t&&t<r&&0<=u&&u<e&&0<l&&(t=n[e=t+r*u<<2],r=n[1+e],u=n[2+e],a=n[3+e],o=x(Y.round(o),0,255),i=x(Y.round(i),0,255),f=x(Y.round(f),0,255),l=x(Y.round(255*l),0,255),o!==t||i!==r||f!==u||a<l)&&(n[e]=o,n[1+e]=i,n[2+e]=f,n[3+e]=l)}function F(n,r,e,t){for(var u,o=0,i=0,f=0,l=r*e<<2;f<l;f+=4,++o)r<=o&&(o=0,++i),0<(u=n[f+3])&&t(o,i,n[f],n[f+1],n[f+2],u/255)}function x(n,r,e){return Y.min(Y.max(n,r),e)}function en(n,r){return Y.abs(n-r)<e}function L(n,r){return Y.abs(n-r)<Number.EPSILON}function l(n,r){n=Y.abs(n),r=Y.abs(r);var e=0;return L(n,0)?r:L(r,0)?n:r<n?n*Y.sqrt(1+(e=r/n)*e):n<r?r*Y.sqrt(1+(e=n/r)*e):n*t}function c(n,r,e){var t=r[0],r=r[1],u=e[0],e=e[1],o=n[0],n=n[1],u=u-t,e=e-r,i=l(u,e);return L(i,0)?l(o-t,n-r):Y.abs(u*(r-n)-e*(t-o))/i}function O(n,r,e,t){null==r&&(r=B),null==e&&(e=S);var u,o,i=[];if(t)for(o=n(0),i.push(o[0],o[1]),u=0;u<r;++u)!function n(r,e,t,u,o,i,f){if(u<=t||en(t,u))return;var l=(t+u)/2,i=i||e(t),f=f||e(u),a=e(l);c(a,i,f)<=o?r.push(f[0],f[1]):(n(r,e,t,l,o,i,a),n(r,e,l,u,o,a,f))}(i,n,0===u?0:u/r,r===u+1?1:(u+1)/r,e,null,null);else for(u=0;u<=r;++u)o=n(0===u?0:r===u?1:u/r),i.push(o[0],o[1]);return i}return f.VERSION="0.9.0",f.prototype={constructor:f,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,setLineDash:null,strokeRect:null,fillRect:null,strokePolyline:null,strokeArc:null,strokeBezier:null},f.createImageData=function(n,r){return{data:new u(n*r<<2),width:n,height:r}},f.getRGBAFrom=function(e){var t;return"function"==typeof e?function(n,r){n=e(n,r);return[n[0],n[1],n[2],3<n.length?n[3]/255:1]}:(t=[e[0],e[1],e[2],3<e.length?x(e[3],0,1):1],function(n,r){return t})},f.setRGBATo=function(i){var c,y,s;return"function"==typeof i?function(n,r,e,t,u,o){0<o&&i(n,r,e,t,u,x(Y.round(255*o),0,255))}:(c=i.width,y=i.height,s=i.data,function(n,r,e,t,u,o){var i,f,l,a;0<=n&&n<c&&0<=r&&r<y&&0<o&&(r=s[n=n+c*r<<2],i=s[1+n],f=s[2+n],0<(a=(o=o)+(l=s[3+n]/255)*(1-o)))&&(s[n]=x(Y.round((e*o+r*l*(1-o))/a),0,255),s[1+n]=x(Y.round((t*o+i*l*(1-o))/a),0,255),s[2+n]=x(Y.round((u*o+f*l*(1-o))/a),0,255),s[3+n]=x(Y.round(255*a),0,255))})},f});