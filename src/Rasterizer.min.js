/**
*   Rasterizer
*   rasterize, draw and fill lines, rectangles and curves
*
*   @version 0.9.5
*   https://github.com/foo123/Rasterizer
*
**/
!function(e,n,t){"use strict";"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.call(e)}):n in e||(e[n]=t.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}("undefined"!=typeof self?self:this,"Rasterizer",function(n){"use strict";var h=Object.defineProperty,Y=Math,r=Y.sqrt(2),d=Y.PI,y=2*d,o=6,a=r,c=.5,t="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:"undefined"!=typeof Uint8Array?Uint8Array:Array;function s(n,e,t){var r=this;if(!(r instanceof s))return new s(n,e,t);var u=s.getRGBAFrom([0,0,0,1]),o=s.getRGBAFrom([0,0,0,1]),l="butt",i="miter",f=1,a=[],c=[new g(n,e,t,u,o,f,a,l,i)];h(r,"strokeStyle",{get:function(){return""},set:function(n){u=s.getRGBAFrom(n),c[c.length-1].strokeStyle=u}}),h(r,"fillStyle",{get:function(){return""},set:function(n){o=s.getRGBAFrom(n),c[c.length-1].fillStyle=o}}),h(r,"lineWidth",{get:function(){return f},set:function(n){0<(n=Y.abs(+n||0))&&(c[c.length-1].lineWidth=f=n)}}),h(r,"lineCap",{get:function(){return l},set:function(n){n=String(n).toLowerCase(),-1!==["butt","square"].indexOf(n)?c[c.length-1].lineCap=l=n:C('"'+n+'" lineCap is not supported!')}}),h(r,"lineJoin",{get:function(){return i},set:function(n){n=String(n).toLowerCase(),-1!==["miter","bevel"].indexOf(n)?c[c.length-1].lineJoin=i=n:C('"'+n+'" lineJoin is not supported!')}}),h(r,"lineDash",{get:function(){return a.slice()},set:function(n){1&(n=[].concat(n)).length&&(n=n.concat(n)),c[c.length-1].lineDash=a=n}}),r.setLineDash=function(n){r.lineDash=n},r.strokeRect=function(n,e,t,r){c[c.length-1].strokeRect(n,e,t,r)},r.fillRect=function(n,e,t,r){c[c.length-1].fillRect(n,e,t,r)},r.beginPath=function(){c.push(new g(n,e,t,u,o,f,a,l,i))},r.closePath=function(){c[c.length-1].closePath()},r.moveTo=function(n,e){c[c.length-1].moveTo(n,e)},r.lineTo=function(n,e){c[c.length-1].lineTo(n,e)},r.ellipse=function(n,e,t,r,u,o,l,i){c[c.length-1].ellipse(n,e,t,r,u,o,l,i)},r.quadraticCurveTo=function(n,e,t,r){c[c.length-1].quadraticCurveTo(n,e,t,r)},r.bezierCurveTo=function(n,e,t,r,u,o){c[c.length-1].bezierCurveTo(n,e,t,r,u,o)},r.stroke=function(){c.forEach(function(n){n.stroke()})},r.fill=function(e){e=String(e||"nonzero").toLowerCase(),-1===["nonzero","evenodd"].indexOf(e)&&(e="nonzero"),c.forEach(function(n){n.fill(e)})}}function g(J,B,o,l,i,f,e,a,c){var r,G,L,O,s,E,F=this,W=[[0,0]],I=1;f=f||1,e=e||[],a=a||"butt",c=c||"miter",L=function(){r={}},O=function(n){for(var e in r){var t=r[e],e=e.split(",");n(+e[0],+e[1],t)}},G=function(n,e,t){0<=n&&n<J&&0<=e&&e<B&&0<t&&(t*=I,n=String(n)+","+String(e),(r[n]||0)<t)&&(r[n]=t)},s=function(n,e,t){var r=l(n,e),u=3<r.length?r[3]:1;0<u&&o(n,e,r[0],r[1],r[2],u*t)},E=function(n,e,t){var r=i(n,e),u=3<r.length?r[3]:1;0<u&&o(n,e,r[0],r[1],r[2],u*t)},h(F,"strokeStyle",{get:function(){},set:function(n){l=n}}),h(F,"fillStyle",{get:function(){},set:function(n){i=n}}),h(F,"lineWidth",{get:function(){return f},set:function(n){f=n}}),h(F,"lineCap",{get:function(){return a},set:function(n){a=n}}),h(F,"lineJoin",{get:function(){return c},set:function(n){c=n}}),h(F,"lineDash",{get:function(){return e},set:function(n){e=n}}),F.moveTo=function(n,e){return W.push([n,e]),F},F.lineTo=function(n,e){return W[W.length-1].push(n,e),F},F.ellipse=function(n,e,t,r,u,o,l,i){n=function(t,r,u,o,n,l,e,i){i&&(e=-e-d);var f=Y.cos(n),a=Y.sin(n),c=e-l,i=v(function(n){var n=l+n*c,e=u*Y.cos(n),n=o*Y.sin(n);return[t+f*e-a*n,r+a*e+f*n]});Y.abs(c)+1e-4>=y&&!tn(i[0],i[i.length-2],1e-4)&&!tn(i[1],i[i.length-1],1e-4)&&i.push(i[0],i[1]);return i}(n,e,t,r,u,o,l,i);return n.lineCap="butt",n.lineJoin="bevel",W.push(n),W.push([0,0]),F},F.quadraticCurveTo=function(n,e,t,r){var u=W[W.length-1].p.pop(),u=p([W[W.length-1].p.pop(),u,n,e,t,r]);return W[W.length-1].push.apply(W[W.length-1],u),F},F.bezierCurveTo=function(n,e,t,r,u,o){var l=W[W.length-1].pop(),l=p([W[W.length-1].pop(),l,n,e,t,r,u,o]);return W[W.length-1].push.apply(W[W.length-1],l),F},F.closePath=function(){return W[W.length-1].push(W[W.length-1][0],W[W.length-1][1]),W.push([0,0]),F},F.stroke=function(){if(0<f){var n=I,e=J-1,t=B-1;f<1&&(I=f),L();for(var r,u=0,o=W.length;u<o;++u)(r=W[u])&&2<r.length&&U(G,r,f,0,r.lineCap||a,r.lineJoin||c,0,0,e,t);O(s),I=n}return F},F.fill=function(n){var e=I,t=J-1,r=B-1;L(),I=.65;for(var u,o=0,l=W.length;o<l;++o)(u=W[o])&&2<u.length&&U(G,u,.65,0,"butt","bevel",0,0,t,r);I=e;var i=G,e=n,f=0,n=0,a=t,c=r,s=function(n){var e,t,r,u,o,l=[],i=n.length,f=1/0,a=-1/0;for(r=u=0;r<i;++r)if(o=n[r],0<(e=o.length-2)){for(t=0;t<e;t+=2)f=Y.min(f,o[t+1]),a=Y.max(a,o[t+1]),o[t+1]>o[t+3]?l.push([o[t+2],o[t+3],o[t],o[t+1],-1,u,0,0]):l.push([o[t],o[t+1],o[t+2],o[t+3],1,u,0,0]);f=Y.min(f,o[1+e]),a=Y.max(a,o[1+e]),++u}return l.ymin=f,l.ymax=a,l}(W),h=s.ymin,d=s.ymax;if(s.length){s.sort(N);var y,g,p,x,m,v,b,C,T,q,R,S,k,w,A=s.length,P=new Array(A),z=0,D="nonzero"!==e;for(h=Y.max(n,Y.round(h)),d=Y.min(c,Y.round(d));h<=d;++h){for(;z<A&&s[z][3]<h;)++z;if(A<=z)break;if((p=s[z])[1]>h)h=Y.floor(p[1]);else{for(q=p[0],R=p[2],m=p[1],v=p[3],T=rn(m,v)?(S=!1,C=Y.min(q,R),Y.max(q,R)):C=S=(R-q)*(h-m)/(v-m)+q,p[6]=S,p[7]=0,P[0]=p,y=z+(g=1);y<A&&s[y][1]<=h;++y)(p=s[y])[3]>=h&&(q=p[0],R=p[2],m=p[1],v=p[3],T=rn(m,v)?(S=!1,C=Y.min(C,q,R),Y.max(T,q,R)):(S=(R-q)*(h-m)/(v-m)+q,C=Y.min(C,S),Y.max(T,S)),p[6]=S,p[7]=0,P[g++]=p);if(x=function(n,e){var t,r,u,o,l=0;for(t=0;t<e;++t)if(!(u=n[t])[7])for(r=t+1;r<e;++r)(o=n[r])[7]||u[4]!==o[4]||u[5]!==o[5]||(tn(u[0],o[0],1e-5)&&tn(u[1],o[1],1e-5)&&tn(u[2],o[2],1e-5)&&tn(u[3],o[3],1e-5)||tn(u[3],o[1],1e-6))&&(o[7]=1,++l);return l}(P,g),!(g<x+2||(C=Y.max(f,Y.round(C+.5)),(T=Y.min(a,Y.round(T-.5)))<C)))if(D)for(b=C;b<=T;++b){for(w=k=!1,y=0;y<g;++y)(p=P[y])[7]||!1!==(S=p[6])&&(S<b&&(k=!k),b<S)&&(w=!w);k&&w&&i(b,h,1)}else for(b=C;b<=T;++b){for(y=w=k=0;y<g;++y)(p=P[y])[7]||!1!==(S=p[6])&&(S<b||b<S)&&(x=function(n,e,t,r,u,o){return(n-t)*(o-r)-(u-t)*(e-r)<0?-1:1}(b,h,p[p[4]<0?2:0],p[p[4]<0?3:1],p[p[4]<0?0:2],p[p[4]<0?1:3]),S<b&&(k+=x),b<S)&&(w+=x);k&&w&&i(b,h,1)}}}}return O(E),F},F.strokeRect=function(n,e,t,r){var u;1<=t&&1<=r&&0<f&&(u=I,f<1&&(I=f),L(),U(G,[n,e,n+t-1,e,n+t-1,e+r-1,n,e+r-1,n,e],f,0,"butt","miter",0,0,J-1,B-1),O(s),I=u)},F.fillRect=function(n,e,t,r){return 1<=t&&1<=r&&(L(),k(G,Y.round(n),Y.round(e),Y.round(n+t-1),Y.round(e+r-1),0,0,J-1,B-1),O(E)),F},F.dispose=function(){W=null}}function U(O,n,E,F,e,W,I,U,N,j){var t,r,u,o,l,M,V,H,K,i,f,Q,a,c,s,h,d,y,g,p,x,m,v,b,C,T,q,R,S,k,w,A,P,z,D,J,B,G,L,X=n.length;if(X<6)Z(O,r=n[0],u=n[1],o=n[2],l=n[3],i=Y.abs(o-r),f=Y.abs(l-u),(a=$(E,i,f))[0],a[1],e,e,I,U,N,j);else for(X-=2,t=0;t<X;t+=2)Z(O,r=n[t],u=n[t+1],o=n[t+2],l=n[t+3],i=Y.abs(o-r),f=Y.abs(l-u),(a=$(E,i,f))[0],a[1],0===t?e:null,X===t+2?e:null,I,U,N,j),1<E&&0<t&&(c=O,s=M,h=V,d=r,y=u,g=o,p=l,x=H,m=K,v=Q[0],b=Q[1],C=i,T=f,q=a[0],R=a[1],k=I,w=U,A=N,P=j,L=G=B=J=D=z=void 0,"bevel"!==(S=W)&&"miter"!==S||tn(m*C,T*x,1e-4)||(d<s&&g<d&&(L=s,s=g,g=L,L=h,h=p,p=L,L=x,x=C,C=L,L=m,m=T,T=L,L=v,v=q,q=L,L=b,b=R,R=L),b={x:s-(C=(x=d<s?-1:1)*v),y:h+(v=(T=y<h?-1:1)*b)},s={x:s+C,y:h-v},h={x:d-C,y:y+v},C={x:d+C,y:y-v},D={x:d-(q=(v=g<d?-1:1)*q),y:y+(R=(z=p<y?-1:1)*R)},J={x:d+q,y:y-R},B={x:g-q,y:p+R},g={x:g+q,y:p-R},q={x:d,y:y},p=x==v?T==z?rn(m,0)?(G=C,J):(G=h,D):(G=h,J):(G=C,D),"bevel"===S?(en(c,G.x,G.y,p.x,p.y,null,null,k,w,A,P),nn(c,q.x,q.y,G.x,G.y,p.x,p.y,k,w,A,P)):"miter"===S&&(L=x==v?T==z?rn(m,0)?_(s.x,s.y,C.x,C.y,J.x,J.y,g.x,g.y):_(b.x,b.y,h.x,h.y,D.x,D.y,B.x,B.y):_(b.x,b.y,h.x,h.y,J.x,J.y,g.x,g.y):_(s.x,s.y,C.x,C.y,D.x,D.y,B.x,B.y),en(c,G.x,G.y,L.x,L.y,null,null,k,w,A,P),en(c,p.x,p.y,L.x,L.y,null,null,k,w,A,P),nn(c,q.x,q.y,G.x,G.y,p.x,p.y,k,w,A,P),nn(c,L.x,L.y,G.x,G.y,p.x,p.y,k,w,A,P)))),M=r,V=u,H=i,K=f,Q=a}function Z(n,e,t,r,u,o,l,i,f,a,c,s,h,d,y){var g;0===i&&0===f?en(n,e,t,r,u,o,l,s,h,d,y):(n=n,t=t,u=u,l=l,i=i,f=f,a=a,c=c,s=s,h=h,d=d,y=y,(r=r)<(e=e)&&(g=e,e=r,r=g,g=t,t=u,u=g,g=a,a=c,c=g),g=u<t?-1:1,rn(o=o,0)?("square"===a&&(t-=g*i),"square"===c&&(u+=g*i),k(n,Y.round(e-i),Y.round(t),Y.round(e+i),Y.round(u),s,h,d,y)):rn(l,0)?("square"===a&&(e-=+f),"square"===c&&(r+=+f),k(n,Y.round(e),Y.round(t-f),Y.round(r),Y.round(t+f),s,h,d,y)):("square"===a&&(e-=+f,t-=g*i),"square"===c&&(r+=+f,u+=g*i),l=r-(o=+i),c=u+(a=g*f),i=r+o,g=u-a,en(n,f=e-o,r=t+a,u=e+o,e=t-a,null,null,s,h,d,y),en(n,u,e,i,g,null,null,s,h,d,y),en(n,i,g,l,c,null,null,s,h,d,y),en(n,l,c,f,r,null,null,s,h,d,y),nn(n,f,r,u,e,l,c,s,h,d,y),nn(n,u,e,l,c,i,g,s,h,d,y)))}function $(n,e,t){return n<=1?[0,0]:rn(e,0)?[(n-1)/2,0]:rn(t,0)?[0,(n-1)/2]:[t*(n=(n-1)/2)/(t=x(e,t)),e*n/t]}function _(n,e,t,r,u,o,l,i){var f=r-e,a=n-t,t=t*e-n*r,e=i-o,n=u-l,r=l*o-u*i,l=f*n-a*e;return!rn(l,0)&&{x:(a*r-t*n)/l,y:(t*e-f*r)/l}}function k(n,e,t,r,u,o,l,i,f){var a,c;if(r<e&&(a=e,e=r,r=a),u<t&&(c=t,t=u,u=c),null!=o){if(r<o||i<e||u<l||f<t)return;e=Y.max(e,o),t=Y.max(t,l),r=Y.min(r,i),u=Y.min(u,f)}if(t===u)for(a=e;a<=r;++a)n(a,t,1);else if(e===r)for(c=t;c<=u;++c)n(e,c,1);else for(c=t;c<=u;++c)for(a=e;a<=r;++a)n(a,c,1)}function nn(n,e,t,r,u,o,l,i,f,a,c){var s,h,d,y,g,p,x,m,v,b,C,T,q,R,S=null!=i;if(!S||!(Y.max(e,r,o)<i||Y.min(e,r,o)>a||Y.max(t,u,l)<f||Y.min(t,u,l)>c)){if(u<t&&(d=t,t=u,u=d,d=e,e=r,r=d),l<t&&(d=t,t=l,l=d,d=e,e=o,o=d),l<u&&(d=u,u=l,l=d,d=r,r=o,o=d),rn(b=l-t,0))return y=Y.round(t),k(n,s=Y.round(Y.min(e,r,o)),y,h=Y.round(Y.max(e,r,o)),y,i,f,a,c);for(T=l-u,x=o-e,m=r-e,v=o-r,q=rn(C=u-t,0),R=rn(T,0),y=Y.round(t+.5),g=u,p=Y.round(l-.5),S&&(y=Y.max(f,y),p=Y.min(c,p));y<=p;++y)if(h=y<g?q?(s=e,r):(s=x*(y-t)/b+e,m*(y-t)/C+e):R?(s=r,o):(s=x*(y-t)/b+e,v*(y-u)/T+r),Y.abs(h-s)<1)(!S||i<=s&&s<=a)&&n(Y.round(s),y,1);else for(h<s&&(d=s,s=h,h=d),s=Y.round(s+.5),h=Y.round(h-.5),S&&(s=Y.max(i,s),h=Y.min(a,h));s<=h;++s)n(s,y,1)}}function en(n,e,t,r,u,o,l,i,f,a,c){var s=Y.min(e,r),h=Y.max(e,r),d=Y.min(t,u),y=Y.max(t,u);if(!(h<i||a<s||y<f||c<d)){if(null==o&&(o=Y.abs(r-e),l=Y.abs(u-t)),s<i||a<h||d<f||c<y){s=function(n,e,t,r,u,o,l,i){var f=-(t=-(t-n)),a=-(r=-(r-e)),u=n-u,l=l-n,o=e-o,i=i-e,c=1,s=0;if(!(0==t&&u<0||0==f&&l<0||0==r&&o<0||0==a&&i<0||(0!=t&&(u=u/t,l=l/f,t<0?(s<u&&(s=u),l<c&&(c=l)):(s<l&&(s=l),u<c&&(c=u))),0!=r&&(t=o/r,l=i/a,r<0?(s<t&&(s=t),l<c&&(c=l)):(s<l&&(s=l),t<c&&(c=t))),c<s)))return[n+f*s,e+a*s,n+f*c,e+a*c]}(e,t,r,u,i,f,a,c);if(!s)return;e=s[0],t=s[1],r=s[2],u=s[3]}if(rn(o,0)||rn(l,0))return k(n,Y.round(e),Y.round(t),Y.round(r),Y.round(u));var g,p,x,m,v=0,b=0,C=0,h=o<l;if(h&&(g=e,e=t,t=g,g=r,r=u,u=g,g=o,o=l,l=g),r<e&&(g=e,e=r,r=g,p=t,t=u,u=p),y=t+(m=(u<t?-1:1)*l/o)*((d=Y.round(e))-e),i=1-(e+.5-Y.floor(e+.5)),f=d,C=1-(b=y-(a=Y.floor(y))),h?(n(a,f,C*i),n(a+1,f,b*i)):(n(f,a,C*i),n(f,a+1,b*i)),v=y+m,y=u+m*((d=Y.round(r))-r),i=r+.5-Y.floor(r+.5),x=d,C=1-(b=y-(c=Y.floor(y))),h?(n(c,x,C*i),n(c+1,x,b*i)):(n(x,c,C*i),n(x,c+1,b*i)),h)for(g=f+1;g<x;++g)0<(C=1-(b=v-(p=Y.floor(v))))&&n(p,g,C),0<b&&n(p+1,g,b),v+=m;else for(g=f+1;g<x;++g)0<(C=1-(b=v-(p=Y.floor(v))))&&n(g,p,C),0<b&&n(g,p+1,b),v+=m}}function p(l){return v(6<l.length?function(n){var e=1-n,t=n*n,r=e*e,u=r*e,o=t*n,r=3*r*n,n=3*t*e;return[u*l[0]+r*l[2]+n*l[4]+o*l[6],u*l[1]+r*l[3]+n*l[5]+o*l[7]]}:function(n){var e=1-n,t=e*e,e=2*e*n,n=n*n;return[t*l[0]+e*l[2]+n*l[4],t*l[1]+e*l[3]+n*l[5]]})}function x(n,e){n=Y.abs(n),e=Y.abs(e);var t=0;return rn(n,0)?e:rn(e,0)?n:e<n?n*Y.sqrt(1+(t=e/n)*t):n<e?e*Y.sqrt(1+(t=n/e)*t):n*r}function m(n,e,t){var r=e[0],e=e[1],u=t[0],t=t[1],o=n[0],n=n[1],u=u-r,t=t-e,l=x(u,t);return rn(l,0)?x(o-r,n-e):Y.abs(u*(e-n)-t*(r-o))/l}function v(n){var e,t=[],r=o,u=n(0);for(t.push(u[0],u[1]),e=0;e<r;++e)u=function n(e,t,r,u,o,l){if(u<=r||tn(r,u,1e-6))return o;o=o||t(r);l=l||t(u);var i,f=x(l[0]-o[0],l[1]-o[1]);if(f<=a){if(f<1)return o;e.push(l[0],l[1])}else m(i=t(f=(r+u)/2),o,l)<=c?e.push(l[0],l[1]):(n(e,t,r,f,o,i),n(e,t,f,u,i,l));return l}(t,n,0===e?0:e/r,r===e+1?1:(e+1)/r,u,null);return t}function tn(n,e,t){return Y.abs(n-e)<(t||1e-6)}function rn(n,e){return Y.abs(n-e)<Number.EPSILON}function b(n,e,t){return Y.min(Y.max(n,e),t)}function N(n,e){var t=n[1]-e[1];return tn(t,0)?n[3]-e[3]:t}function C(n){throw new Error(n)}return s.VERSION="0.9.5",s.prototype={constructor:s,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,setLineDash:null,strokeRect:null,fillRect:null,beginPath:null,closePath:null,moveTo:null,lineTo:null,ellipse:null,quadraticCurveTo:null,bezierCurveTo:null,stroke:null,fill:null},s.createImageData=function(n,e){return{data:new t(n*e<<2),width:n,height:e}},s.getRGBAFrom=function(t){var r;return"function"==typeof t?function(n,e){n=t(n,e);return[n[0],n[1],n[2],3<n.length?n[3]/255:1]}:(r=[t[0],t[1],t[2],3<t.length?t[3]:1],function(n,e){return r})},s.setRGBATo=function(l){var c,s,h;return"function"==typeof l?function(n,e,t,r,u,o){0<o&&l(n,e,t,r,u,o)}:(c=l.width,s=l.height,h=l.data,function(n,e,t,r,u,o){var l,i,f,a;0<=n&&n<c&&0<=e&&e<s&&0<o&&(e=h[n=n+c*e<<2],l=h[1+n],i=h[2+n],0<(a=(o=o)+(f=h[3+n]/255)*(1-o)))&&(h[n]=b(Y.round((t*o+e*f*(1-o))/a),0,255),h[1+n]=b(Y.round((r*o+l*f*(1-o))/a),0,255),h[2+n]=b(Y.round((u*o+i*f*(1-o))/a),0,255),h[3+n]=b(Y.round(255*a),0,255))})},g.prototype={constructor:g,dispose:null,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,moveTo:null,lineTo:null,ellipse:null,quadraticCurveTo:null,bezierCurveTo:null,closePath:null,stroke:null,fill:null,strokeRect:null,fillRect:null},s.Path=g,s});