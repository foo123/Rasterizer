/**
*   Rasterizer
*   rasterize, draw and fill lines, rectangles and curves
*
*   @version 0.9.2
*   https://github.com/foo123/Rasterizer
*
**/
!function(r,n,t){"use strict";"object"==typeof module&&module.exports?module.exports=t.call(r):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.call(r)}):n in r||(r[n]=t.call(r)||1)&&"function"==typeof define&&define.amd&&define(function(){return r[n]})}("undefined"!=typeof self?self:this,"Rasterizer",function(n){"use strict";var r=Object.defineProperty,Y=Math,B=Y.PI,t=1e-6,e=Y.sqrt(2),S=20,C=1,u="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:"undefined"!=typeof Uint8Array?Uint8Array:Array;function y(h,p,o){var g=this;if(!(g instanceof y))return new y(h,p,o);var e,i=y.getRGBAFrom([0,0,0,1]),f=y.getRGBAFrom([0,0,0,1]),l="butt",a="miter",b=1,q=[],A=function(){e={}},R=function(n){for(var r in e)n((r=+r)%h,~~(r/h),e[r])},k=function(n,r,t){0<=n&&n<h&&0<=r&&r<p&&0<t&&(e[n=n+r*h]||0)<t&&(e[n]=t)},w=function(n,r,t){var e=i(n,r),u=3<e.length?e[3]:1;0<u&&o(n,r,e[0],e[1],e[2],u*t)},c=function(n,r,t){var e=f(n,r),u=3<e.length?e[3]:1;0<u&&o(n,r,e[0],e[1],e[2],u*t)};r(g,"strokeStyle",{get:function(){return""},set:function(n){i=y.getRGBAFrom(n)}}),r(g,"fillStyle",{get:function(){return""},set:function(n){f=y.getRGBAFrom(n)}}),r(g,"lineWidth",{get:function(){return b},set:function(n){0<(n=Y.abs(+n||0))&&(b=n)}}),r(g,"lineCap",{get:function(){return l},set:function(n){n=String(n).toLowerCase(),-1!==["butt","square"].indexOf(n)?l=n:s('"'+n+'" lineCap is not supported!')}}),r(g,"lineJoin",{get:function(){return a},set:function(n){n=String(n).toLowerCase(),-1!==["miter","bevel"].indexOf(n)?a=n:s('"'+n+'" lineJoin is not supported!')}}),r(g,"lineDash",{get:function(){return q.slice()},set:function(n){1&(n=[].concat(n)).length&&(n=n.concat(n)),q=n}}),g.setLineDash=function(n){g.lineDash=n},g.strokeRect=function(n,r,t,e){return 1<=t&&1<=e&&0<b&&(A(),D(k,[n,r,n+t-1,r,n+t-1,r+e-1,n,r+e-1,n,r],b,0,"butt","miter",0,0,h-1,p-1),R(w)),g},g.fillRect=function(n,r,t,e){var u,o,i,f,l,a;return 1<=t&&1<=e&&(A(),u=k,t=(n=n)+t-1,e=(r=r)+e-1,i=o=0,f=h-1,l=p-1,a=Y.min(n,t),n=Y.max(n,t),t=Y.min(r,e),r=Y.max(r,e),o<n&&a<f&&i<r&&t<l&&((a<o||f<n||t<i||l<r)&&(a=Y.max(a,o),t=Y.max(t,i),n=Y.min(n,f),r=Y.min(r,l)),G(u,Y.round(a),Y.round(t),Y.round(n),Y.round(r))),R(c)),g},g.strokePolyline=function(){return 0<b&&(A(),D(k,arguments,b,0,l,a,0,0,h-1,p-1),R(w)),g},g.strokeArc=function(n,r,t,e,u,o,i,f){var l,a,c,y,s,x,d,m,v;return 0<b&&(f=f?(d=-i-B,o):(d=o,i),A(),o=k,l=n,a=r,c=t,y=e,i=u,s=d,x=f,n=b,r=q,e=t=0,u=h-1,d=p-1,m=Y.cos(i),v=Y.sin(i),D(o,L(function(n){var n=s+n*(x-s),r=c*Y.cos(n),n=y*Y.sin(n);return[l+m*r-v*n,a+v*r+m*n]},S,C,!0),n,0,"butt","bevel",t,e,u,d),R(w)),g},g.strokeBezier=function(){var i,n,r,t,e,u,o,f;return 0<b&&4<=arguments.length&&(A(),4===arguments.length?D(k,arguments,b,0,l,a,0,0,h-1,p-1):(n=b,r=q,t=l,u=e=0,o=h-1,f=p-1,D(k,L(6<(i=arguments).length?function(n){var r=1-n,t=n*n,e=r*r,u=e*r,o=t*n,e=3*e*n,n=3*t*r;return[u*i[0]+e*i[2]+n*i[4]+o*i[6],u*i[1]+e*i[3]+n*i[5]+o*i[7]]}:function(n){var r=1-n,t=r*r,r=2*r*n,n=n*n;return[t*i[0]+r*i[2]+n*i[4],t*i[1]+r*i[3]+n*i[5]]},S,C,!0),n,0,t,"bevel",e,u,o,f)),R(w)),g}}function D(U,n,z,E,r,J,N,j,W,M){var t,e,u,o,i,T,V,H,K,f,l,Q,a,c,y,s,x,d,m,v,h,p,g,b,q,A,R,k,X,w,B,S,C,D,G,F,L,O,P,I=n.length;if(I<6)Z(U,e=n[0],u=n[1],o=n[2],i=n[3],f=Y.abs(o-e),l=Y.abs(i-u),(a=$(z,f,l))[0],a[1],r,r,N,j,W,M);else for(I-=2,t=0;t<I;t+=2)Z(U,e=n[t],u=n[t+1],o=n[t+2],i=n[t+3],f=Y.abs(o-e),l=Y.abs(i-u),(a=$(z,f,l))[0],a[1],0===t?r:null,I===t+2?r:null,N,j,W,M),1<z&&0<t&&(c=U,y=T,s=V,x=e,d=u,m=o,v=i,h=H,p=K,g=Q[0],b=Q[1],q=f,A=l,R=a[0],k=a[1],X=J,w=N,B=j,S=W,C=M,P=O=L=F=G=D=void 0,tn(p*q,A*h)||(x<y&&m<x&&(P=y,y=m,m=P,P=s,s=v,v=P,P=h,h=q,q=P,P=p,p=A,A=P,P=g,g=R,R=P,P=b,b=k,k=P),b={x:y-(q=(h=x<y?-1:1)*g),y:s+(g=(A=d<s?-1:1)*b)},y={x:y+q,y:s-g},s={x:x-q,y:d+g},q={x:x+q,y:d-g},G={x:x-(R=(g=m<x?-1:1)*R),y:d+(k=(D=v<d?-1:1)*k)},F={x:x+R,y:d-k},L={x:m-R,y:v+k},m={x:m+R,y:v-k},R={x:x,y:d},v=h==g?A==D?0===p?(O=q,F):(O=s,G):(O=s,F):(O=q,G),"bevel"===X&&(rn(c,O.x,O.y,v.x,v.y),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,w,B,S,C)),"miter"===X&&(P=h==g?A==D?0===p?_(y.x,y.y,q.x,q.y,F.x,F.y,m.x,m.y):_(b.x,b.y,s.x,s.y,G.x,G.y,L.x,L.y):_(b.x,b.y,s.x,s.y,F.x,F.y,m.x,m.y):_(y.x,y.y,q.x,q.y,G.x,G.y,L.x,L.y),rn(c,O.x,O.y,P.x,P.y),rn(c,v.x,v.y,P.x,P.y),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,w,B,S,C),nn(c,P.x,P.y,O.x,O.y,v.x,v.y,w,B,S,C)))),T=e,V=u,H=f,K=l,Q=a}function Z(n,r,t,e,u,o,i,f,l,a,c,y,s,x,d){var m,v=Y.min(r,e),h=Y.max(r,e),p=Y.min(t,u),g=Y.max(t,u);if(y<h&&v<x&&s<g&&p<d){if(v<y||x<h||p<s||d<g){var v=function(n,r,t,e,u,o,i,f){var t=-(t-n),l=-t,e=-(e-r),a=-e,u=n-u,i=i-n,o=r-o,f=f-r,c=1,y=0;if(!(0==t&&u<0||0==l&&i<0||0==e&&o<0||0==a&&f<0||(0!=t&&(u=u/t,i=i/l,t<0?(y<u&&(y=u),i<c&&(c=i)):(y<i&&(y=i),u<c&&(c=u))),0!=e&&(t=o/e,i=f/a,e<0?(y<t&&(y=t),i<c&&(c=i)):(y<i&&(y=i),t<c&&(c=t))),c<y)))return[n+l*y,r+a*y,n+l*c,r+a*c]}(r,t,e,u,y,s,x,d);if(!v)return;tn(r,v[0])&&tn(t,v[1])||(a=null),tn(e,v[2])&&tn(u,v[3])||(c=null),r=v[0],t=v[1],e=v[2],u=v[3]}0===f&&0===l?rn(n,r,t,e,u,o,i):(h=n,p=t,g=u,y=i,s=f,x=l,d=a,v=c,(n=e)<(t=r)&&(m=t,t=n,n=m,m=p,p=g,g=m,m=d,d=v,v=m),m=g<p?-1:1,F(u=o,0)?("square"===d&&(p-=m*s),"square"===v&&(g+=m*s),G(h,Y.round(t-s),Y.round(p),Y.round(t+s),Y.round(g))):F(y,0)?("square"===d&&(t-=+x),"square"===v&&(n+=+x),G(h,Y.round(t),Y.round(p-x),Y.round(n),Y.round(p+x))):("square"===d&&(t-=+x,p-=m*s),"square"===v&&(n+=+x,g+=m*s),d={x:n-(u=+s),y:g+(y=m*x)},v={x:n+u,y:g-y},rn(h,(s={x:t-u,y:p+y}).x,s.y,(m={x:t+u,y:p-y}).x,m.y),rn(h,m.x,m.y,v.x,v.y),rn(h,v.x,v.y,d.x,d.y),rn(h,d.x,d.y,s.x,s.y),nn(h,s.x,s.y,m.x,m.y,d.x,d.y),nn(h,m.x,m.y,d.x,d.y,v.x,v.y)))}}function $(n,r,t){return n<=1?[0,0]:F(r,0)?[(n-1)/2,0]:F(t,0)?[0,(n-1)/2]:[t*(n=(n-1)/2)/(t=f(r,t)),r*n/t]}function _(n,r,t,e,u,o,i,f){var l=e-r,a=n-t,t=t*r-n*e,r=f-o,n=u-i,e=i*o-u*f,i=l*n-a*r;return!tn(i,0)&&{x:(a*e-t*n)/i,y:(t*r-l*e)/i}}function G(n,r,t,e,u){var o,i;if(e<r&&(o=r,r=e,e=o),u<t&&(i=t,t=u,u=i),t===u)for(o=r;o<=e;++o)n(o,t,1);else if(r===e)for(i=t;i<=u;++i)n(r,i,1);else for(i=t;i<=u;++i)for(o=r;o<=e;++o)n(o,i,1)}function nn(n,r,t,e,u,o,i,f,l,a,c){var y,s,x,d,m,v,h,p,g,b,q,A,R,k,w=null!=f;if(u<t&&(x=t,t=u,u=x,x=r,r=e,e=x),i<t&&(x=t,t=i,i=x,x=r,r=o,o=x),i<u&&(x=u,u=i,i=x,x=e,e=o,o=x),F(b=i-t,0))return d=Y.round(t),G(n,y=Y.round(Y.min(r,e,o)),d,s=Y.round(Y.max(r,e,o)),d);for(A=i-u,h=o-r,p=e-r,g=o-e,R=F(q=u-t,0),k=F(A,0),d=Y.round(t+.5),m=Y.round(u),v=Y.round(i-.5),w&&(d=Y.max(l,d),v=Y.min(c,v));d<=v;++d)if(s=d<m?R?(y=r,e):(y=h*(d-t)/b+r,p*(d-t)/q+r):k?(y=e,o):(y=h*(d-t)/b+r,g*(d-u)/A+e),!tn(y,s))for(s<y&&(x=y,y=s,s=x),y=Y.round(y+.5),s=Y.round(s-.5),w&&(y=Y.max(f,y),s=Y.min(a,s));y<=s;++y)n(y,d,1)}function rn(n,r,t,e,u,o,i){if(null==o&&(o=Y.abs(e-r),i=Y.abs(u-t)),F(o,0)||F(i,0))return G(n,Y.round(r),Y.round(t),Y.round(e),Y.round(u));var f,l,a,c,y,s=0,x=0,d=0,m=0,v=0,h=0,p=0;if(e<r&&(f=r,r=e,e=f,l=t,t=u,u=l),y=u<t?-1:1,f=r,l=t,a=e,c=u,r=Y.round(f),t=Y.round(l),e=Y.round(a),u=Y.round(c),o<i)for(x=f+(s=+o/i),v=1-(l+.5-t),h=1-(c+.5-u),m=1-(d=f-r),f=r,l=t,d*=v,m*=v;;){if(0<m&&n(f,l,m),0<d&&n(f+1,l,d),l===u)return;m=1-(d=x-(p=Y.floor(x))),(l+=y)===u?(f=e,d*=h,m*=h):f=p,x+=s}else for(x=l+(s=y*i/o),v=1-(f+.5-r),h=1-(a+.5-e),m=1-(d=l-t),f=r,l=t,d*=v,m*=v;;){if(0<m&&n(f,l,m),0<d&&n(f,l+1,d),f===e)return;m=1-(d=x-(p=Y.floor(x))),(f+=1)===e?(l=u,d*=h,m*=h):l=p,x+=s}}function s(n){throw new Error(n)}function x(n,r,t){return Y.min(Y.max(n,r),t)}function tn(n,r){return Y.abs(n-r)<t}function F(n,r){return Y.abs(n-r)<Number.EPSILON}function f(n,r){n=Y.abs(n),r=Y.abs(r);var t=0;return F(n,0)?r:F(r,0)?n:r<n?n*Y.sqrt(1+(t=r/n)*t):n<r?r*Y.sqrt(1+(t=n/r)*t):n*e}function c(n,r,t){var e=r[0],r=r[1],u=t[0],t=t[1],o=n[0],n=n[1],u=u-e,t=t-r,i=f(u,t);return F(i,0)?f(o-e,n-r):Y.abs(u*(r-n)-t*(e-o))/i}function L(n,r,t,e){null==r&&(r=S),null==t&&(t=C);var u,o,i=[];if(e)for(o=n(0),i.push(o[0],o[1]),u=0;u<r;++u)!function n(r,t,e,u,o,i,f){if(u<=e||tn(e,u))return;var l=(e+u)/2,i=i||t(e),f=f||t(u),a=t(l);c(a,i,f)<=o?r.push(f[0],f[1]):(n(r,t,e,l,o,i,a),n(r,t,l,u,o,a,f))}(i,n,0===u?0:u/r,r===u+1?1:(u+1)/r,t,null,null);else for(u=0;u<=r;++u)o=n(0===u?0:r===u?1:u/r),i.push(o[0],o[1]);return i}return y.VERSION="0.9.2",y.prototype={constructor:y,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,setLineDash:null,strokeRect:null,fillRect:null,strokePolyline:null,strokeArc:null,strokeBezier:null},y.createImageData=function(n,r){return{data:new u(n*r<<2),width:n,height:r}},y.getRGBAFrom=function(t){var e;return"function"==typeof t?function(n,r){n=t(n,r);return[n[0],n[1],n[2],3<n.length?n[3]/255:1]}:(e=[t[0],t[1],t[2],3<t.length?t[3]:1],function(n,r){return e})},y.setRGBATo=function(i){var c,y,s;return"function"==typeof i?function(n,r,t,e,u,o){0<o&&i(n,r,t,e,u,o)}:(c=i.width,y=i.height,s=i.data,function(n,r,t,e,u,o){var i,f,l,a;0<=n&&n<c&&0<=r&&r<y&&0<o&&(r=s[n=n+c*r<<2],i=s[1+n],f=s[2+n],0<(a=(o=o)+(l=s[3+n]/255)*(1-o)))&&(s[n]=x(Y.round((t*o+r*l*(1-o))/a),0,255),s[1+n]=x(Y.round((e*o+i*l*(1-o))/a),0,255),s[2+n]=x(Y.round((u*o+f*l*(1-o))/a),0,255),s[3+n]=x(Y.round(255*a),0,255))})},y});