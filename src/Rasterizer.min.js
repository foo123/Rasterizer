/**
*   Rasterizer
*   rasterize, draw and fill lines, rectangles and curves
*
*   @version 0.9.4
*   https://github.com/foo123/Rasterizer
*
**/
!function(r,n,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(r):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.call(r)}):n in r||(r[n]=e.call(r)||1)&&"function"==typeof define&&define.amd&&define(function(){return r[n]})}("undefined"!=typeof self?self:this,"Rasterizer",function(n){"use strict";var r=Object.defineProperty,Y=Math,D=Y.PI,e=1e-6,t=Y.sqrt(2),G=8,c=2,F=1,u="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:"undefined"!=typeof Uint8Array?Uint8Array:Array;function s(h,g,o){var b=this;if(!(b instanceof s))return new s(h,g,o);var t,i=s.getRGBAFrom([0,0,0,1]),l=s.getRGBAFrom([0,0,0,1]),q="butt",a="miter",A=1,R=1,k=[],S=function(){t={}},w=function(n){for(var r in t){var e=t[r],r=r.split(",");n(+r[0],+r[1],e)}},B=function(n,r,e){0<=n&&n<h&&0<=r&&r<g&&0<e&&(e*=R,n=String(n)+","+String(r),(t[n]||0)<e)&&(t[n]=e)},C=function(n,r,e){var t=i(n,r),u=3<t.length?t[3]:1;0<u&&o(n,r,t[0],t[1],t[2],u*e)},f=function(n,r,e){var t=l(n,r),u=3<t.length?t[3]:1;0<u&&o(n,r,t[0],t[1],t[2],u*e)};r(b,"strokeStyle",{get:function(){return""},set:function(n){i=s.getRGBAFrom(n)}}),r(b,"fillStyle",{get:function(){return""},set:function(n){l=s.getRGBAFrom(n)}}),r(b,"lineWidth",{get:function(){return A},set:function(n){0<(n=Y.abs(+n||0))&&(A=n)}}),r(b,"lineCap",{get:function(){return q},set:function(n){n=String(n).toLowerCase(),-1!==["butt","square"].indexOf(n)?q=n:d('"'+n+'" lineCap is not supported!')}}),r(b,"lineJoin",{get:function(){return a},set:function(n){n=String(n).toLowerCase(),-1!==["miter","bevel"].indexOf(n)?a=n:d('"'+n+'" lineJoin is not supported!')}}),r(b,"lineDash",{get:function(){return k.slice()},set:function(n){1&(n=[].concat(n)).length&&(n=n.concat(n)),k=n}}),b.setLineDash=function(n){b.lineDash=n},b.strokeRect=function(n,r,e,t){var u;return 1<=e&&1<=t&&0<A&&(u=R,A<1&&(R=A),S(),L(B,[n,r,n+e-1,r,n+e-1,r+t-1,n,r+t-1,n,r],A,0,"butt","miter",0,0,h-1,g-1),w(C),R=u),b},b.fillRect=function(n,r,e,t){var u,o,i,l;return 1<=e&&1<=t&&(S(),e=n+e-1,t=(r=r)+t-1,o=u=0,i=h-1,l=g-1,O(B,Y.round(n),Y.round(r),Y.round(e),Y.round(t),u,o,i,l),w(f)),b},b.strokePolyline=function(){var n;return 0<A&&(n=R,A<1&&(R=A),S(),L(B,arguments,A,0,q,a,0,0,h-1,g-1),w(C),R=n),b},b.strokeArc=function(n,r,e,t,u,o,i,l){var f,a,c,s,d,y,x,m,v,p;return 0<A&&(l=l?(x=-i-D,o):(x=o,i),o=R,A<1&&(R=A),S(),i=B,f=n,a=r,c=e,s=t,n=u,d=x,y=l,r=A,e=k,t=q,x=u=0,l=h-1,m=g-1,v=Y.cos(n),p=Y.sin(n),L(i,P(function(n){var n=d+n*(y-d),r=c*Y.cos(n),n=s*Y.sin(n);return[f+v*r-p*n,a+p*r+v*n]},G,F,!0),r,0,t,"bevel",u,x,l,m),w(C),R=o),b},b.strokeBezier=function(){var n,i,r,e,t,u,o,l,f;return 0<A&&4<=arguments.length&&(n=R,A<1&&(R=A),S(),4===arguments.length?L(B,arguments,A,0,q,a,0,0,h-1,g-1):(r=A,e=k,t=q,o=u=0,l=h-1,f=g-1,L(B,P(6<(i=arguments).length?function(n){var r=1-n,e=n*n,t=r*r,u=t*r,o=e*n,t=3*t*n,n=3*e*r;return[u*i[0]+t*i[2]+n*i[4]+o*i[6],u*i[1]+t*i[3]+n*i[5]+o*i[7]]}:function(n){var r=1-n,e=r*r,r=2*r*n,n=n*n;return[e*i[0]+r*i[2]+n*i[4],e*i[1]+r*i[3]+n*i[5]]},G,F,!0),r,0,t,"bevel",u,o,l,f)),w(C),R=n),b}}function L(U,n,z,E,r,J,N,j,W,M){var e,t,u,o,i,T,V,H,K,l,f,Q,a,c,s,d,y,x,m,v,p,h,g,b,q,A,R,k,S,w,B,C,D,G,F,L,O,P,I,X=n.length;if(X<6)Z(U,t=n[0],u=n[1],o=n[2],i=n[3],l=Y.abs(o-t),f=Y.abs(i-u),(a=$(z,l,f))[0],a[1],r,r,N,j,W,M);else for(X-=2,e=0;e<X;e+=2)Z(U,t=n[e],u=n[e+1],o=n[e+2],i=n[e+3],l=Y.abs(o-t),f=Y.abs(i-u),(a=$(z,l,f))[0],a[1],0===e?r:null,X===e+2?r:null,N,j,W,M),1<z&&0<e&&(c=U,s=T,d=V,y=t,x=u,m=o,v=i,p=H,h=K,g=Q[0],b=Q[1],q=l,A=f,R=a[0],k=a[1],w=N,B=j,C=W,D=M,I=P=O=L=F=G=void 0,"bevel"!==(S=J)&&"miter"!==S||en(h*q,A*p)||(y<s&&m<y&&(I=s,s=m,m=I,I=d,d=v,v=I,I=p,p=q,q=I,I=h,h=A,A=I,I=g,g=R,R=I,I=b,b=k,k=I),b={x:s-(q=(p=y<s?-1:1)*g),y:d+(g=(A=x<d?-1:1)*b)},s={x:s+q,y:d-g},d={x:y-q,y:x+g},q={x:y+q,y:x-g},F={x:y-(R=(g=m<y?-1:1)*R),y:x+(k=(G=v<x?-1:1)*k)},L={x:y+R,y:x-k},O={x:m-R,y:v+k},m={x:m+R,y:v-k},R={x:y,y:x},v=p==g?A==G?tn(h,0)?(P=q,L):(P=d,F):(P=d,L):(P=q,F),"bevel"===S?(rn(c,P.x,P.y,v.x,v.y,null,null,w,B,C,D),nn(c,R.x,R.y,P.x,P.y,v.x,v.y,w,B,C,D)):"miter"===S&&(I=p==g?A==G?tn(h,0)?_(s.x,s.y,q.x,q.y,L.x,L.y,m.x,m.y):_(b.x,b.y,d.x,d.y,F.x,F.y,O.x,O.y):_(b.x,b.y,d.x,d.y,L.x,L.y,m.x,m.y):_(s.x,s.y,q.x,q.y,F.x,F.y,O.x,O.y),rn(c,P.x,P.y,I.x,I.y,null,null,w,B,C,D),rn(c,v.x,v.y,I.x,I.y,null,null,w,B,C,D),nn(c,R.x,R.y,P.x,P.y,v.x,v.y,w,B,C,D),nn(c,I.x,I.y,P.x,P.y,v.x,v.y,w,B,C,D)))),T=t,V=u,H=l,K=f,Q=a}function Z(n,r,e,t,u,o,i,l,f,a,c,s,d,y,x){var m;0===l&&0===f?rn(n,r,e,t,u,o,i,s,d,y,x):(n=n,e=e,u=u,i=i,l=l,f=f,a=a,c=c,s=s,d=d,y=y,x=x,(t=t)<(r=r)&&(m=r,r=t,t=m,m=e,e=u,u=m,m=a,a=c,c=m),m=u<e?-1:1,tn(o=o,0)?("square"===a&&(e-=m*l),"square"===c&&(u+=m*l),O(n,Y.round(r-l),Y.round(e),Y.round(r+l),Y.round(u),s,d,y,x)):tn(i,0)?("square"===a&&(r-=+f),"square"===c&&(t+=+f),O(n,Y.round(r),Y.round(e-f),Y.round(t),Y.round(e+f),s,d,y,x)):("square"===a&&(r-=+f,e-=m*l),"square"===c&&(t+=+f,u+=m*l),i=t-(o=+l),c=u+(a=m*f),l=t+o,m=u-a,rn(n,f=r-o,t=e+a,u=r+o,r=e-a,null,null,s,d,y,x),rn(n,u,r,l,m,null,null,s,d,y,x),rn(n,l,m,i,c,null,null,s,d,y,x),rn(n,i,c,f,t,null,null,s,d,y,x),nn(n,f,t,u,r,i,c,s,d,y,x),nn(n,u,r,i,c,l,m,s,d,y,x)))}function $(n,r,e){return n<=1?[0,0]:tn(r,0)?[(n-1)/2,0]:tn(e,0)?[0,(n-1)/2]:[e*(n=(n-1)/2)/(e=x(r,e)),r*n/e]}function _(n,r,e,t,u,o,i,l){var f=t-r,a=n-e,e=e*r-n*t,r=l-o,n=u-i,t=i*o-u*l,i=f*n-a*r;return!en(i,0)&&{x:(a*t-e*n)/i,y:(e*r-f*t)/i}}function O(n,r,e,t,u,o,i,l,f){var a,c;if(t<r&&(a=r,r=t,t=a),u<e&&(c=e,e=u,u=c),null!=o){if(t<o||l<r||u<i||f<e)return;r=Y.max(r,o),e=Y.max(e,i),t=Y.min(t,l),u=Y.min(u,f)}if(e===u)for(a=r;a<=t;++a)n(a,e,1);else if(r===t)for(c=e;c<=u;++c)n(r,c,1);else for(c=e;c<=u;++c)for(a=r;a<=t;++a)n(a,c,1)}function nn(n,r,e,t,u,o,i,l,f,a,c){var s,d,y,x,m,v,p,h,g,b,q,A,R,k,S=null!=l;if(!S||!(Y.max(r,t,o)<l||Y.min(r,t,o)>a||Y.max(e,u,i)<f||Y.min(e,u,i)>c)){if(u<e&&(y=e,e=u,u=y,y=r,r=t,t=y),i<e&&(y=e,e=i,i=y,y=r,r=o,o=y),i<u&&(y=u,u=i,i=y,y=t,t=o,o=y),tn(b=i-e,0))return x=Y.round(e),O(n,s=Y.round(Y.min(r,t,o)),x,d=Y.round(Y.max(r,t,o)),x,l,f,a,c);for(A=i-u,p=o-r,h=t-r,g=o-t,R=tn(q=u-e,0),k=tn(A,0),x=Y.round(e+.5),m=u,v=Y.round(i-.5),S&&(x=Y.max(f,x),v=Y.min(c,v));x<=v;++x)if(d=x<m?R?(s=r,t):(s=p*(x-e)/b+r,h*(x-e)/q+r):k?(s=t,o):(s=p*(x-e)/b+r,g*(x-u)/A+t),Y.abs(d-s)<1)(!S||l<=s&&s<=a)&&n(Y.round(s),x,1);else for(d<s&&(y=s,s=d,d=y),s=Y.round(s+.5),d=Y.round(d-.5),S&&(s=Y.max(l,s),d=Y.min(a,d));s<=d;++s)n(s,x,1)}}function rn(n,r,e,t,u,o,i,l,f,a,c){var s=Y.min(r,t),d=Y.max(r,t),y=Y.min(e,u),x=Y.max(e,u);if(!(d<l||a<s||x<f||c<y)){if(null==o&&(o=Y.abs(t-r),i=Y.abs(u-e)),s<l||a<d||y<f||c<x){s=function(n,r,e,t,u,o,i,l){var f=-(e=-(e-n)),a=-(t=-(t-r)),u=n-u,i=i-n,o=r-o,l=l-r,c=1,s=0;if(!(0==e&&u<0||0==f&&i<0||0==t&&o<0||0==a&&l<0||(0!=e&&(u=u/e,i=i/f,e<0?(s<u&&(s=u),i<c&&(c=i)):(s<i&&(s=i),u<c&&(c=u))),0!=t&&(e=o/t,i=l/a,t<0?(s<e&&(s=e),i<c&&(c=i)):(s<i&&(s=i),e<c&&(c=e))),c<s)))return[n+f*s,r+a*s,n+f*c,r+a*c]}(r,e,t,u,l,f,a,c);if(!s)return;r=s[0],e=s[1],t=s[2],u=s[3]}if(tn(o,0)||tn(i,0))return O(n,Y.round(r),Y.round(e),Y.round(t),Y.round(u));var m,v,p,h,g=0,b=0,q=0,d=o<i;if(d&&(m=r,r=e,e=m,m=t,t=u,u=m,m=o,o=i,i=m),t<r&&(m=r,r=t,t=m,v=e,e=u,u=v),x=e+(h=(u<e?-1:1)*i/o)*((y=Y.round(r))-r),l=1-(r+.5-Y.floor(r+.5)),f=y,q=1-(b=x-(a=Y.floor(x))),d?(n(a,f,q*l),n(a+1,f,b*l)):(n(f,a,q*l),n(f,a+1,b*l)),g=x+h,x=u+h*((y=Y.round(t))-t),l=t+.5-Y.floor(t+.5),p=y,q=1-(b=x-(c=Y.floor(x))),d?(n(c,p,q*l),n(c+1,p,b*l)):(n(p,c,q*l),n(p,c+1,b*l)),d)for(m=f+1;m<p;++m)0<(q=1-(b=g-(v=Y.floor(g))))&&n(v,m,q),0<b&&n(v+1,m,b),g+=h;else for(m=f+1;m<p;++m)0<(q=1-(b=g-(v=Y.floor(g))))&&n(m,v,q),0<b&&n(m,v+1,b),g+=h}}function d(n){throw new Error(n)}function y(n,r,e){return Y.min(Y.max(n,r),e)}function en(n,r){return Y.abs(n-r)<e}function tn(n,r){return Y.abs(n-r)<Number.EPSILON}function x(n,r){n=Y.abs(n),r=Y.abs(r);var e=0;return tn(n,0)?r:tn(r,0)?n:r<n?n*Y.sqrt(1+(e=r/n)*e):n<r?r*Y.sqrt(1+(e=n/r)*e):n*t}function m(n,r,e){var t=r[0],r=r[1],u=e[0],e=e[1],o=n[0],n=n[1],u=u-t,e=e-r,i=x(u,e);return tn(i,0)?x(o-t,n-r):Y.abs(u*(r-n)-e*(t-o))/i}function P(n,r,e,t){null==r&&(r=G),null==e&&(e=F);var u,o,i=[];if(t)for(o=n(0),i.push(o[0],o[1]),u=0;u<r;++u)!function n(r,e,t,u,o,i,l){if(u<=t||en(t,u))return;var f,a,i=i||e(t),l=l||e(u);if(x(l[0]-i[0],l[1]-i[1])<=c)return void r.push(l[0],l[1]);f=(t+u)/2;a=e(f);m(a,i,l)<=o?r.push(l[0],l[1]):(n(r,e,t,f,o,i,a),n(r,e,f,u,o,a,l))}(i,n,0===u?0:u/r,r===u+1?1:(u+1)/r,e,null,null);else for(u=0;u<=r;++u)o=n(0===u?0:r===u?1:u/r),i.push(o[0],o[1]);return i}return s.VERSION="0.9.4",s.prototype={constructor:s,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,setLineDash:null,strokeRect:null,fillRect:null,strokePolyline:null,strokeArc:null,strokeBezier:null},s.createImageData=function(n,r){return{data:new u(n*r<<2),width:n,height:r}},s.getRGBAFrom=function(e){var t;return"function"==typeof e?function(n,r){n=e(n,r);return[n[0],n[1],n[2],3<n.length?n[3]/255:1]}:(t=[e[0],e[1],e[2],3<e.length?e[3]:1],function(n,r){return t})},s.setRGBATo=function(i){var c,s,d;return"function"==typeof i?function(n,r,e,t,u,o){0<o&&i(n,r,e,t,u,o)}:(c=i.width,s=i.height,d=i.data,function(n,r,e,t,u,o){var i,l,f,a;0<=n&&n<c&&0<=r&&r<s&&0<o&&(r=d[n=n+c*r<<2],i=d[1+n],l=d[2+n],0<(a=(o=o)+(f=d[3+n]/255)*(1-o)))&&(d[n]=y(Y.round((e*o+r*f*(1-o))/a),0,255),d[1+n]=y(Y.round((t*o+i*f*(1-o))/a),0,255),d[2+n]=y(Y.round((u*o+l*f*(1-o))/a),0,255),d[3+n]=y(Y.round(255*a),0,255))})},s});