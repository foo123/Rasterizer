/**
*   Rasterizer
*   rasterize, draw and fill lines, rectangles and curves
*
*   @version 0.9.3
*   https://github.com/foo123/Rasterizer
*
**/
!function(r,n,t){"use strict";"object"==typeof module&&module.exports?module.exports=t.call(r):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.call(r)}):n in r||(r[n]=t.call(r)||1)&&"function"==typeof define&&define.amd&&define(function(){return r[n]})}("undefined"!=typeof self?self:this,"Rasterizer",function(n){"use strict";var r=Object.defineProperty,Y=Math,B=Y.PI,t=1e-6,e=Y.sqrt(2),C=20,D=1,u="undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:"undefined"!=typeof Uint8Array?Uint8Array:Array;function c(p,h,o){var g=this;if(!(g instanceof c))return new c(p,h,o);var e,i=c.getRGBAFrom([0,0,0,1]),l=c.getRGBAFrom([0,0,0,1]),b="butt",f="miter",q=1,A=[],R=function(){e={}},k=function(n){for(var r in e){var t=e[r],r=r.split(",");n(+r[0],+r[1],t)}},S=function(n,r,t){0<=n&&n<p&&0<=r&&r<h&&0<t&&(n=String(n)+","+String(r),(e[n]||0)<t)&&(e[n]=t)},w=function(n,r,t){var e=i(n,r),u=3<e.length?e[3]:1;0<u&&o(n,r,e[0],e[1],e[2],u*t)},a=function(n,r,t){var e=l(n,r),u=3<e.length?e[3]:1;0<u&&o(n,r,e[0],e[1],e[2],u*t)};r(g,"strokeStyle",{get:function(){return""},set:function(n){i=c.getRGBAFrom(n)}}),r(g,"fillStyle",{get:function(){return""},set:function(n){l=c.getRGBAFrom(n)}}),r(g,"lineWidth",{get:function(){return q},set:function(n){0<(n=Y.abs(+n||0))&&(q=n)}}),r(g,"lineCap",{get:function(){return b},set:function(n){n=String(n).toLowerCase(),-1!==["butt","square"].indexOf(n)?b=n:s('"'+n+'" lineCap is not supported!')}}),r(g,"lineJoin",{get:function(){return f},set:function(n){n=String(n).toLowerCase(),-1!==["miter","bevel"].indexOf(n)?f=n:s('"'+n+'" lineJoin is not supported!')}}),r(g,"lineDash",{get:function(){return A.slice()},set:function(n){1&(n=[].concat(n)).length&&(n=n.concat(n)),A=n}}),g.setLineDash=function(n){g.lineDash=n},g.strokeRect=function(n,r,t,e){return 1<=t&&1<=e&&0<q&&(R(),G(S,[n,r,n+t-1,r,n+t-1,r+e-1,n,r+e-1,n,r],q,0,"butt","miter",0,0,p-1,h-1),k(w)),g},g.fillRect=function(n,r,t,e){var u,o,i,l;return 1<=t&&1<=e&&(R(),t=n+t-1,e=(r=r)+e-1,o=u=0,i=p-1,l=h-1,F(S,Y.round(n),Y.round(r),Y.round(t),Y.round(e),u,o,i,l),k(a)),g},g.strokePolyline=function(){return 0<q&&(R(),G(S,arguments,q,0,b,f,0,0,p-1,h-1),k(w)),g},g.strokeArc=function(n,r,t,e,u,o,i,l){var f,a,c,s,d,y,x,m,v;return 0<q&&(l=l?(x=-i-B,o):(x=o,i),R(),o=S,f=n,a=r,c=t,s=e,i=u,d=x,y=l,n=q,r=A,t=b,u=e=0,x=p-1,l=h-1,m=Y.cos(i),v=Y.sin(i),G(o,L(function(n){var n=d+n*(y-d),r=c*Y.cos(n),n=s*Y.sin(n);return[f+m*r-v*n,a+v*r+m*n]},C,D,!0),n,0,t,"bevel",e,u,x,l),k(w)),g},g.strokeBezier=function(){var i,n,r,t,e,u,o,l;return 0<q&&4<=arguments.length&&(R(),4===arguments.length?G(S,arguments,q,0,b,f,0,0,p-1,h-1):(n=q,r=A,t=b,u=e=0,o=p-1,l=h-1,G(S,L(6<(i=arguments).length?function(n){var r=1-n,t=n*n,e=r*r,u=e*r,o=t*n,e=3*e*n,n=3*t*r;return[u*i[0]+e*i[2]+n*i[4]+o*i[6],u*i[1]+e*i[3]+n*i[5]+o*i[7]]}:function(n){var r=1-n,t=r*r,r=2*r*n,n=n*n;return[t*i[0]+r*i[2]+n*i[4],t*i[1]+r*i[3]+n*i[5]]},C,D,!0),n,0,t,"bevel",e,u,o,l)),k(w)),g}}function G(U,n,z,E,r,J,N,j,W,M){var t,e,u,o,i,T,V,H,K,l,f,Q,a,c,s,d,y,x,m,v,p,h,g,b,q,A,R,k,X,S,w,B,C,D,G,F,L,O,P,I=n.length;if(I<6)Z(U,e=n[0],u=n[1],o=n[2],i=n[3],l=Y.abs(o-e),f=Y.abs(i-u),(a=$(z,l,f))[0],a[1],r,r,N,j,W,M);else for(I-=2,t=0;t<I;t+=2)Z(U,e=n[t],u=n[t+1],o=n[t+2],i=n[t+3],l=Y.abs(o-e),f=Y.abs(i-u),(a=$(z,l,f))[0],a[1],0===t?r:null,I===t+2?r:null,N,j,W,M),1<z&&0<t&&(c=U,s=T,d=V,y=e,x=u,m=o,v=i,p=H,h=K,g=Q[0],b=Q[1],q=l,A=f,R=a[0],k=a[1],X=J,S=N,w=j,B=W,C=M,P=O=L=F=G=D=void 0,tn(h*q,A*p)||(y<s&&m<y&&(P=s,s=m,m=P,P=d,d=v,v=P,P=p,p=q,q=P,P=h,h=A,A=P,P=g,g=R,R=P,P=b,b=k,k=P),b={x:s-(q=(p=y<s?-1:1)*g),y:d+(g=(A=x<d?-1:1)*b)},s={x:s+q,y:d-g},d={x:y-q,y:x+g},q={x:y+q,y:x-g},G={x:y-(R=(g=m<y?-1:1)*R),y:x+(k=(D=v<x?-1:1)*k)},F={x:y+R,y:x-k},L={x:m-R,y:v+k},m={x:m+R,y:v-k},R={x:y,y:x},v=p==g?A==D?en(h,0)?(O=q,F):(O=d,G):(O=d,F):(O=q,G),"bevel"===X?(rn(c,O.x,O.y,v.x,v.y,null,null,S,w,B,C),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,S,w,B,C)):"miter"===X&&(P=p==g?A==D?en(h,0)?_(s.x,s.y,q.x,q.y,F.x,F.y,m.x,m.y):_(b.x,b.y,d.x,d.y,G.x,G.y,L.x,L.y):_(b.x,b.y,d.x,d.y,F.x,F.y,m.x,m.y):_(s.x,s.y,q.x,q.y,G.x,G.y,L.x,L.y),rn(c,O.x,O.y,P.x,P.y,null,null,S,w,B,C),rn(c,v.x,v.y,P.x,P.y,null,null,S,w,B,C),nn(c,R.x,R.y,O.x,O.y,v.x,v.y,S,w,B,C),nn(c,P.x,P.y,O.x,O.y,v.x,v.y,S,w,B,C)))),T=e,V=u,H=l,K=f,Q=a}function Z(n,r,t,e,u,o,i,l,f,a,c,s,d,y,x){var m;0===l&&0===f?rn(n,r,t,e,u,o,i,s,d,y,x):(n=n,t=t,u=u,i=i,l=l,f=f,a=a,c=c,s=s,d=d,y=y,x=x,(e=e)<(r=r)&&(m=r,r=e,e=m,m=t,t=u,u=m,m=a,a=c,c=m),m=u<t?-1:1,en(o=o,0)?("square"===a&&(t-=m*l),"square"===c&&(u+=m*l),F(n,Y.round(r-l),Y.round(t),Y.round(r+l),Y.round(u),s,d,y,x)):en(i,0)?("square"===a&&(r-=+f),"square"===c&&(e+=+f),F(n,Y.round(r),Y.round(t-f),Y.round(e),Y.round(t+f),s,d,y,x)):("square"===a&&(r-=+f,t-=m*l),"square"===c&&(e+=+f,u+=m*l),i=e-(o=+l),c=u+(a=m*f),l=e+o,m=u-a,rn(n,f=r-o,e=t+a,u=r+o,r=t-a,null,null,s,d,y,x),rn(n,u,r,l,m,null,null,s,d,y,x),rn(n,l,m,i,c,null,null,s,d,y,x),rn(n,i,c,f,e,null,null,s,d,y,x),nn(n,f,e,u,r,i,c,s,d,y,x),nn(n,u,r,i,c,l,m,s,d,y,x)))}function $(n,r,t){return n<=1?[0,0]:en(r,0)?[(n-1)/2,0]:en(t,0)?[0,(n-1)/2]:[t*(n=(n-1)/2)/(t=l(r,t)),r*n/t]}function _(n,r,t,e,u,o,i,l){var f=e-r,a=n-t,t=t*r-n*e,r=l-o,n=u-i,e=i*o-u*l,i=f*n-a*r;return!tn(i,0)&&{x:(a*e-t*n)/i,y:(t*r-f*e)/i}}function F(n,r,t,e,u,o,i,l,f){var a,c;if(e<r&&(a=r,r=e,e=a),u<t&&(c=t,t=u,u=c),null!=o){if(e<o||l<r||u<i||f<t)return;r=Y.max(r,o),t=Y.max(t,i),e=Y.min(e,l),u=Y.min(u,f)}if(t===u)for(a=r;a<=e;++a)n(a,t,1);else if(r===e)for(c=t;c<=u;++c)n(r,c,1);else for(c=t;c<=u;++c)for(a=r;a<=e;++a)n(a,c,1)}function nn(n,r,t,e,u,o,i,l,f,a,c){var s,d,y,x,m,v,p,h,g,b,q,A,R,k,S=null!=l;if(u<t&&(y=t,t=u,u=y,y=r,r=e,e=y),i<t&&(y=t,t=i,i=y,y=r,r=o,o=y),i<u&&(y=u,u=i,i=y,y=e,e=o,o=y),en(b=i-t,0))return x=Y.round(t),F(n,s=Y.round(Y.min(r,e,o)),x,d=Y.round(Y.max(r,e,o)),x,l,f,a,c);for(A=i-u,p=o-r,h=e-r,g=o-e,R=en(q=u-t,0),k=en(A,0),x=Y.round(t+.5),m=Y.round(u),v=Y.round(i-.5),S&&(x=Y.max(f,x),v=Y.min(c,v));x<=v;++x)if(d=x<m?R?(s=r,e):(s=p*(x-t)/b+r,h*(x-t)/q+r):k?(s=e,o):(s=p*(x-t)/b+r,g*(x-u)/A+e),Y.abs(d-s)<1)(!S||l<=s&&s<=a)&&n(Y.round(s),x,1);else for(d<s&&(y=s,s=d,d=y),s=Y.round(s+.5),d=Y.round(d-.5),S&&(s=Y.max(l,s),d=Y.min(a,d));s<=d;++s)n(s,x,1)}function rn(n,r,t,e,u,o,i,l,f,a,c){var s=Y.min(r,e),d=Y.max(r,e),y=Y.min(t,u),x=Y.max(t,u);if(!(d<l||a<s||x<f||c<y)){if(null==o&&(o=Y.abs(e-r),i=Y.abs(u-t)),s<l||a<d||y<f||c<x){s=function(n,r,t,e,u,o,i,l){var f=-(t=-(t-n)),a=-(e=-(e-r)),u=n-u,i=i-n,o=r-o,l=l-r,c=1,s=0;if(!(0==t&&u<0||0==f&&i<0||0==e&&o<0||0==a&&l<0||(0!=t&&(u=u/t,i=i/f,t<0?(s<u&&(s=u),i<c&&(c=i)):(s<i&&(s=i),u<c&&(c=u))),0!=e&&(t=o/e,i=l/a,e<0?(s<t&&(s=t),i<c&&(c=i)):(s<i&&(s=i),t<c&&(c=t))),c<s)))return[n+f*s,r+a*s,n+f*c,r+a*c]}(r,t,e,u,l,f,a,c);if(!s)return;r=s[0],t=s[1],e=s[2],u=s[3]}if(en(o,0)||en(i,0))return F(n,Y.round(r),Y.round(t),Y.round(e),Y.round(u));var m,v,p,h,g=0,b=0,q=0,d=o<i;if(d&&(m=r,r=t,t=m,m=e,e=u,u=m,m=o,o=i,i=m),e<r&&(m=r,r=e,e=m,v=t,t=u,u=v),x=t+(h=(u<t?-1:1)*i/o)*((y=Y.round(r))-r),l=1-(r+.5-Y.floor(r+.5)),f=y,q=1-(b=x-(a=Y.floor(x))),d?(n(a,f,q*l),n(a+1,f,b*l)):(n(f,a,q*l),n(f,a+1,b*l)),g=x+h,x=u+h*((y=Y.round(e))-e),l=e+.5-Y.floor(e+.5),p=y,q=1-(b=x-(c=Y.floor(x))),d?(n(c,p,q*l),n(c+1,p,b*l)):(n(p,c,q*l),n(p,c+1,b*l)),d)for(m=f+1;m<p;++m)0<(q=1-(b=g-(v=Y.floor(g))))&&n(v,m,q),0<b&&n(v+1,m,b),g+=h;else for(m=f+1;m<p;++m)0<(q=1-(b=g-(v=Y.floor(g))))&&n(m,v,q),0<b&&n(m,v+1,b),g+=h}}function s(n){throw new Error(n)}function y(n,r,t){return Y.min(Y.max(n,r),t)}function tn(n,r){return Y.abs(n-r)<t}function en(n,r){return Y.abs(n-r)<Number.EPSILON}function l(n,r){n=Y.abs(n),r=Y.abs(r);var t=0;return en(n,0)?r:en(r,0)?n:r<n?n*Y.sqrt(1+(t=r/n)*t):n<r?r*Y.sqrt(1+(t=n/r)*t):n*e}function d(n,r,t){var e=r[0],r=r[1],u=t[0],t=t[1],o=n[0],n=n[1],u=u-e,t=t-r,i=l(u,t);return en(i,0)?l(o-e,n-r):Y.abs(u*(r-n)-t*(e-o))/i}function L(n,r,t,e){null==r&&(r=C),null==t&&(t=D);var u,o,i=[];if(e)for(o=n(0),i.push(o[0],o[1]),u=0;u<r;++u)!function n(r,t,e,u,o,i,l){if(u<=e||tn(e,u))return;var f=(e+u)/2,i=i||t(e),l=l||t(u),a=t(f);d(a,i,l)<=o?r.push(l[0],l[1]):(n(r,t,e,f,o,i,a),n(r,t,f,u,o,a,l))}(i,n,0===u?0:u/r,r===u+1?1:(u+1)/r,t,null,null);else for(u=0;u<=r;++u)o=n(0===u?0:r===u?1:u/r),i.push(o[0],o[1]);return i}return c.VERSION="0.9.3",c.prototype={constructor:c,strokeStyle:null,fillStyle:null,lineWidth:null,lineCap:null,lineJoin:null,lineDash:null,setLineDash:null,strokeRect:null,fillRect:null,strokePolyline:null,strokeArc:null,strokeBezier:null},c.createImageData=function(n,r){return{data:new u(n*r<<2),width:n,height:r}},c.getRGBAFrom=function(t){var e;return"function"==typeof t?function(n,r){n=t(n,r);return[n[0],n[1],n[2],3<n.length?n[3]/255:1]}:(e=[t[0],t[1],t[2],3<t.length?t[3]:1],function(n,r){return e})},c.setRGBATo=function(i){var c,s,d;return"function"==typeof i?function(n,r,t,e,u,o){0<o&&i(n,r,t,e,u,o)}:(c=i.width,s=i.height,d=i.data,function(n,r,t,e,u,o){var i,l,f,a;0<=n&&n<c&&0<=r&&r<s&&0<o&&(r=d[n=n+c*r<<2],i=d[1+n],l=d[2+n],0<(a=(o=o)+(f=d[3+n]/255)*(1-o)))&&(d[n]=y(Y.round((t*o+r*f*(1-o))/a),0,255),d[1+n]=y(Y.round((e*o+i*f*(1-o))/a),0,255),d[2+n]=y(Y.round((u*o+l*f*(1-o))/a),0,255),d[3+n]=y(Y.round(255*a),0,255))})},c});