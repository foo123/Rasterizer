<!DOCTYPE html>
<html><head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Rasterizer Lines</title>
<style type="text/css">
body {
    font-size: 16px;
    font-family: Arial, san-serif;
    background: white;
}
#container {
    position: relative;
    width: 100%;
    height: 1000px;
    padding: 0;
    margin: 0 auto;
    overflow: visible;
}
.button {
    position: relative;
    display: inline-block;
    padding: 8px 12px;
    background: white;
    color: black;
    border: 1px solid #676767;
    border-radius: 8px;
    cursor: pointer;
    margin: 1px;
    margin-right: 10px;
}
.button:hover {
    border-width: 2px;
    margin: 0;
    margin-right: 9px;
}
.canvas {
    display: inline-block;
    width: 200px;
    height: 200px;
    margin-right: 10px
    margin-bottom: 10px;
}
canvas {
    position: relative;
    display: block;
    width: 200px;
    height: 200px;
    margin: 0px
}
h4 {
    display: block;
}
</style>
</head><body>
<h1>Rasterizer <span id="ver"></span> Lines / Curves</h1>
<div id="container">
<h4>Thick Lines:</h4>
<div class="canvas">
<b>Canvas:</b>
<canvas id="test11" width="200" height="200"></canvas></div>
<div class="canvas">
<b>Rasterizer:</b>
<canvas id="test12" width="200" height="200"></canvas></div>
</div>
<script src="./Gradient.js"></script>
<script src="../src/Rasterizer.js"></script>
<script>
(function() {
"use strict";
document.getElementById('ver').textContent = 'v.'+Rasterizer.VERSION;

const w = 200, h = 200;

function addColorStops(gradient)
{
    ([0.0, 0.33, 0.66, 1.0]).forEach((s, i) => {
        gradient.addColorStop(s, (['red', 'yellow', 'green', 'blue'])[i]);
    });
    return gradient;
}
function drawLine(x1, y1, x2, y2, lw, ld, lc, lj)
{
    const canvas1 = document.getElementById('test11');
    const canvas2 = document.getElementById('test12');
    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lj = lj || 'miter';//'bevel';//'round';
    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = '#000';
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(
        w, h,
        Rasterizer.setRGBATo(imData)
    );
    r.strokeStyle = [0,0,0];
    r.lineCap = lc;
    r.lineJoin = lj;
    r.lineWidth = lw;
    r.setLineDash(ld);
    r.drawLine(x1, y1, x2, y2);
    ctx2.putImageData(imData, 0, 0);
}
function drawLines(x1, y1, x2, y2, x3, y3, lw, ld, lc, lj)
{
    const canvas1 = document.getElementById('test11');
    const canvas2 = document.getElementById('test12');
    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lj = lj || 'miter';//'bevel';//'round';
    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = '#000';
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.lineTo(x3, y3);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(
        w, h,
        Rasterizer.setRGBATo(imData)
    );
    r.strokeStyle = [0,0,0];
    r.lineCap = lc;
    r.lineJoin = lj;
    r.lineWidth = lw;
    r.setLineDash(ld);
    r.drawLine(x1, y1, x2, y2);
    r.drawLine(x2, y2, x3, y3);
    r.joinLines(x1, y1, x2, y2, x3, y3);
    ctx2.putImageData(imData, 0, 0);
}
function drawGradientLine(x1, y1, x2, y2, lw, ld, lc, lj, grad1, grad2)
{
    const canvas1 = document.getElementById('test11');
    const canvas2 = document.getElementById('test12');
    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lj = lj || 'miter';//'bevel';//'round';
    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(
        w, h,
        Rasterizer.setRGBATo(imData)
    );
    r.strokeStyle = grad2.getColorAt.bind(grad2);
    r.lineCap = lc;
    r.lineJoin = lj;
    r.lineWidth = lw;
    r.setLineDash(ld);
    r.drawLine(x1, y1, x2, y2);
    ctx2.putImageData(imData, 0, 0);
}

function drawGradientArc(cx, cy, rx, ry, a, t0, t1, fs, lw, ld, lc, grad1, grad2)
{
    const canvas1 = document.getElementById('test11');
    const canvas2 = document.getElementById('test12');
    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lc = lc || 'butt';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.ellipse(cx, cy, rx, ry, a, t0, t1, fs);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(
        w, h,
        Rasterizer.setRGBATo(imData)
    );
    r.strokeStyle = grad2.getColorAt.bind(grad2);
    r.lineCap = lc;
    r.lineWidth = lw;
    r.setLineDash(ld);
    r.drawArc(cx, cy, rx, ry, a, t0, t1, fs);
    ctx2.putImageData(imData, 0, 0);
}
function drawGradientBezier(c, lw, ld, lc, grad1, grad2)
{
    const canvas1 = document.getElementById('test11');
    const canvas2 = document.getElementById('test12');
    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lc = lc || 'butt';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(c[0].x, c[0].y);
    ctx1.bezierCurveTo(c[1].x, c[1].y, c[2].x, c[2].y, c[3].x, c[3].y);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(
        w, h,
        Rasterizer.setRGBATo(imData)
    );
    r.strokeStyle = grad2.getColorAt.bind(grad2);
    r.lineCap = lc;
    r.lineWidth = lw;
    r.setLineDash(ld);
    r.drawBezier(c);
    ctx2.putImageData(imData, 0, 0);
}

//drawLine(20, 20, 80, 100, 1, [1,1]);
//drawLine(20, 20, 80, 100, 4, [5,20], 'butt');
drawLines(20, 10, 40, 60, 80, 62, 20, [], 'butt', 'bevel');
//drawGradientLine(20, 20, 120, 80, 20, [], 'square', 'miter', addColorStops(document.getElementById('test11').getContext('2d').createLinearGradient(20, 20, w - 20, h - 20)), addColorStops(Gradient.createLinearGradient(20, 20, w - 20, h - 20)));
//drawGradientArc(50, 50, 20, 40, 30*Math.PI/180, 1, Math.PI/2, false, 2, [], 'butt', addColorStops(document.getElementById('test11').getContext('2d').createLinearGradient(20, 20, w - 20, h - 20)), addColorStops(Gradient.createLinearGradient(20, 20, w - 20, h - 20)));
})();
</script>
</body></html>
