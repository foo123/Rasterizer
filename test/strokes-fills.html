<!DOCTYPE html>
<html><head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Rasterizer Stroke/Fill Test</title>
<style type="text/css">
body {
    font-size: 16px;
    font-family: Arial, san-serif;
    background: white;
}
.canvas {
    position: relative;
    display: inline-block;
    width: 200px;
    margin-right: 10px
}
canvas {
    position: relative;
    display: block;
    margin: 5px auto;
}
h4 {
    display: block;
}
</style>
</head><body>
<h1>Rasterizer <span id="ver"></span> Strokes / Fills</h1>
<div id="test1" class="canvas">
<b>Canvas:</b><br/>
</div>
<div id="test2" class="canvas">
<b>Rasterizer:</b><br/>
</div>
<script src="./Gradient.js"></script>
<script src="../src/Rasterizer.js"></script>
<script>
(function() {
"use strict";
document.getElementById('ver').textContent = 'v.'+Rasterizer.VERSION;

const w = 200, h = 200,
    test1 = document.getElementById('test1'),
    test2 = document.getElementById('test2');

function text(str, tag)
{
    var el = document.createElement(tag || 'span');
    el.textContent = String(str);
    return el;
}
function addColorStops(gradient)
{
    ([0.0, 0.33, 0.66, 1.0]).forEach((s, i) => {
        gradient.addColorStop(s, (['red', 'yellow', 'green', 'blue'])[i]);
    });
    return gradient;
}
function drawLine(x1, y1, x2, y2, lw, ld, lc)
{
    lw = lw || 1;
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('Line (thickness '+lw+')'));
    test2.appendChild(text('Line (thickness '+lw+')'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = '#000';
    ctx1.lineCap = lc;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = [0,0,0,1];
    ctx.lineCap = lc;
    ctx.lineWidth = lw;
    ctx.setLineDash(ld);
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawPolyline(x1, y1, x2, y2, x3, y3, lw, ld, lc, lj, ml)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text((1 < lw ? 'Thick PolyLine' : 'PolyLine')+' '+lj));
    test2.appendChild(text((1 < lw ? 'Thick PolyLine' : 'PolyLine')+' '+lj));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    ml = ml || 10.0;
    lj = lj || 'miter';//'bevel';//'round';
    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    lw = lw || 1;
    ctx1.beginPath();
    ctx1.strokeStyle = 'rgba(0,0,0,0.5)';
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.miterLimit = ml;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1); // move creates new polyline
    ctx1.lineTo(x2, y2);
    ctx1.lineTo(x3, y3);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = [0,0,0, 0.5];
    ctx.lineCap = lc;
    ctx.lineJoin = lj;
    ctx.miterLimit = ml;
    ctx.lineWidth = lw;
    ctx.setLineDash(ld);
    ctx.moveTo(x1, y1); // move creates new polyline
    ctx.lineTo(x2, y2);
    ctx.lineTo(x3, y3);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawGradientLine(x1, y1, x2, y2, lw, ld, lc)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text((1 < lw ? 'Thick Gradient Line' : 'Gradient Line')));
    test2.appendChild(text((1 < lw ? 'Thick Gradient Line' : 'Gradient Line')));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    lc = lc || 'butt';//'square';//'round';
    ld = ld || [];
    lw = lw || 1;
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = grad2.getColorAt.bind(grad2);
    ctx.lineCap = lc;
    ctx.lineWidth = lw;
    ctx.setLineDash(ld);
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawGradientArc(cx, cy, rx, ry, a, t0, t1, fs, lw, ld, lc, lj)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text((1 < lw ? 'Thick Gradient Arc' : 'Gradient Arc')));
    test2.appendChild(text((1 < lw ? 'Thick Gradient Arc' : 'Gradient Arc')));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    lj = lj || 'miter';
    lc = lc || 'butt';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.ellipse(cx, cy, rx, ry, a, t0, t1, fs);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = grad2.getColorAt.bind(grad2);
    ctx.lineCap = lc;
    ctx.lineJoin = lj;
    ctx.lineWidth = lw;
    ctx.setLineDash(ld);
    ctx.ellipse(cx, cy, rx, ry, a, t0, t1, fs);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawGradientCircles()
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('Circular Arcs'));
    test2.appendChild(text('Circular Arcs'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineWidth = 1;
    ctx1.arc(30, 50, 20, 0, Math.PI, false);
    ctx1.arc(60, 50, 20, 0, Math.PI, true);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = grad2.getColorAt.bind(grad2);
    ctx.lineWidth = 1;
    ctx.arc(30, 50, 20, 0, Math.PI, false);
    ctx.arc(60, 50, 20, 0, Math.PI, true);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawArcTo()
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('ArcTo'));
    test2.appendChild(text('ArcTo'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    // Tangential lines
    ctx1.beginPath();
    ctx1.strokeStyle = "#555";
    ctx1.moveTo(180, 20);
    ctx1.lineTo(180, 130);
    ctx1.lineTo(50, 20);
    ctx1.stroke();

    // Arc
    ctx1.beginPath();
    ctx1.strokeStyle = "#000";
    ctx1.lineWidth = 5;
    ctx1.moveTo(180, 20);
    ctx1.arcTo(180, 130, 50, 20, 40);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    // Tangential lines
    ctx.beginPath();
    ctx.strokeStyle = [0x55, 0x55, 0x55];
    ctx.moveTo(180, 20);
    ctx.lineTo(180, 130);
    ctx.lineTo(50, 20);
    ctx.stroke();

    // Arc
    ctx.beginPath();
    ctx.strokeStyle = [0,0,0];
    ctx.lineWidth = 5;
    ctx.moveTo(180, 20);
    ctx.arcTo(180, 130, 50, 20, 40);
    ctx.stroke();

    ctx2.putImageData(imData, 0, 0);
}
function drawArcs(sx, sy, angle)
{
    if (null == sx) sx = 1;
    if (null == sy) sy = 1;
    angle = angle || 0;
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('Transformed Arc ('+sx+','+sy+','+angle+')'));
    test2.appendChild(text('Transformed Arc ('+sx+','+sy+','+angle+')'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    ctx1.beginPath();
    ctx1.strokeStyle = "#555";
    ctx1.translate(100, 100);
    ctx1.scale(sx, sy);
    ctx1.rotate(angle);
    ctx1.translate(-100, -100);
    ctx1.arc(100, 100, 20, 0, 3*Math.PI/2, false);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = [0x55, 0x55, 0x55];
    ctx.translate(100, 100);
    ctx.scale(sx, sy);
    ctx.rotate(angle);
    ctx.translate(-100, -100);
    ctx.arc(100, 100, 20, 0, 3*Math.PI/2, false, 1);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
    /*
    console.log(angle, ctx.getTransform().a,ctx.getTransform().b,ctx.getTransform().c,ctx.getTransform().d,ctx.getTransform().e,ctx.getTransform().f);
    console.log(angle, ctx1.getTransform().a,ctx1.getTransform().b,ctx1.getTransform().c,ctx1.getTransform().d,ctx1.getTransform().e,ctx1.getTransform().f);
    */
}
function drawBeziers(c, angle)
{
    angle = angle || 0;
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('Transformed Bezier ('+angle+')'));
    test2.appendChild(text('Transformed Bezier ('+angle+')'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    ctx1.beginPath();
    ctx1.strokeStyle = "#555";
    ctx1.translate(100, 100);
    ctx1.rotate(angle);
    ctx1.translate(-100, -100);
    //ctx1.scale(2, 0.5);
    ctx1.moveTo(c[0], c[1]);
    ctx1.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = [0x55, 0x55, 0x55];
    ctx.translate(100, 100);
    ctx.rotate(angle);
    ctx.translate(-100, -100);
    //ctx.scale(2, 0.5);
    ctx.moveTo(c[0], c[1]);
    ctx.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function drawRoundRect()
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text('(Transformed) RoundRect'));
    test2.appendChild(text('(Transformed) RoundRect'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    // Rotated Rounded rectangle with 2 different radii
    ctx1.strokeStyle = "#f00";
    ctx1.translate(50, 55);
    ctx1.rotate(-Math.PI/6);
    ctx1.translate(-50, -55);
    ctx1.beginPath();
    ctx1.roundRect(40, 40, 90, 100, [10, 40]);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.strokeStyle = [0xff,0,0];
    ctx.translate(50, 55);
    ctx.rotate(-Math.PI/6);
    ctx.translate(-50, -55);
    ctx.beginPath();
    ctx.roundRect(40, 40, 90, 100, [10, 40]);
    ctx.stroke();

    ctx2.putImageData(imData, 0, 0);
}
function drawGradientBezier(c, lw, ld, lc, lj)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    test1.appendChild(text((1 < lw ? 'Thick Gradient Bezier' : 'Gradient Bezier')));
    test2.appendChild(text((1 < lw ? 'Thick Gradient Bezier' : 'Gradient Bezier')));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    lj = lj || 'miter';
    lc = lc || 'butt';
    ld = ld || [];
    ctx1.beginPath();
    ctx1.strokeStyle = grad1;
    ctx1.lineCap = lc;
    ctx1.lineJoin = lj;
    ctx1.lineWidth = lw;
    ctx1.setLineDash(ld);
    ctx1.moveTo(c[0], c[1]);
    ctx1.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx1.stroke();

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.strokeStyle = grad2.getColorAt.bind(grad2);
    ctx.lineCap = lc;
    ctx.lineJoin = lj;
    ctx.lineWidth = lw;
    ctx.setLineDash(ld);
    ctx.moveTo(c[0], c[1]);
    ctx.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx.stroke();
    ctx2.putImageData(imData, 0, 0);
}
function fillGradientBezier(c, fillRule)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    fillRule = fillRule || 'nonzero';//'nonzero';//'evenodd';

    test1.appendChild(text('Filled Gradient Bezier ('+fillRule+')'));
    test2.appendChild(text('Filled Gradient Bezier ('+fillRule+')'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    ctx1.beginPath();
    ctx1.fillStyle = grad1;
    ctx1.moveTo(c[0], c[1]);
    ctx1.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx1.fill(fillRule);

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.fillStyle = grad2.getColorAt.bind(grad2);
    ctx.moveTo(c[0], c[1]);
    ctx.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]);
    ctx.fill(fillRule);
    ctx2.putImageData(imData, 0, 0);
}
function fillGradientDisk(cx, cy, r1, r2, fillRule, same)
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';
    fillRule = fillRule || 'nonzero';//'nonzero';//'evenodd';

    test1.appendChild(text('Filled Gradient Disk ('+fillRule+')'));
    test2.appendChild(text('Filled Gradient Disk ('+fillRule+')'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");
    const grad1 = addColorStops(ctx1.createLinearGradient(20, 20, 180, 180));
    const grad2 = addColorStops(Gradient.createLinearGradient(20, 20, 180, 180));

    ctx1.beginPath();
    ctx1.fillStyle = grad1;
    ctx1.ellipse(cx, cy, r2, r2, 0, 0, 2*Math.PI, false);
    ctx1.ellipse(cx, cy, r1, r1, 0, 0, 2*Math.PI, same ? false : true);
    ctx1.fill(fillRule);

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    ctx.beginPath();
    ctx.fillStyle = grad2.getColorAt.bind(grad2);
    ctx.ellipse(cx, cy, r2, r2, 0, 0, 2*Math.PI, false);
    ctx.ellipse(cx, cy, r1, r1, 0, 0, 2*Math.PI, same ? false : true);
    ctx.fill(fillRule);
    ctx2.putImageData(imData, 0, 0);
}
function clip()
{
    const canvas1 = document.createElement('canvas');
    const canvas2 = document.createElement('canvas');
    canvas1.width = w;
    canvas1.height = h;
    canvas2.width = w;
    canvas2.height = h;
    canvas1.style.width = String(w)+'px';
    canvas1.style.height = String(h)+'px';
    canvas2.style.width = String(w)+'px';
    canvas2.style.height = String(h)+'px';

    test1.appendChild(text('Complex Clipping'));
    test2.appendChild(text('Complex Clipping'));
    test1.appendChild(canvas1);
    test2.appendChild(canvas2);

    const ctx1 = canvas1.getContext("2d");
    const ctx2 = canvas2.getContext("2d");

    // Create two clipping paths
    let circlePath = new Path2D();
    circlePath.arc(75, 75, 75, 0, 2 * Math.PI);
    let squarePath = new Path2D();
    squarePath.rect(10, 10, 130, 130);
    // Set the clip to the circle
    ctx1.clip(circlePath);
    // Set the clip to be the intersection of the circle and the square
    ctx1.clip(squarePath);
    // Draw stuff that gets clipped
    ctx1.fillStyle = "#00f";
    ctx1.fillRect(0, 0, w, h);

    const imData = ctx2.getImageData(0, 0, w, h);
    const r = Rasterizer(w, h, Rasterizer.setRGBATo(imData));
    const ctx = r.getContext("2d");
    // Create two clipping paths
    let circlePath2 = new Rasterizer.RenderingContext2D.Path2D();
    circlePath2.arc(75, 75, 75, 0, 2 * Math.PI);
    let squarePath2 = new Rasterizer.RenderingContext2D.Path2D();
    squarePath2.rect(10, 10, 130, 130);
    // Set the clip to the circle
    ctx.clip(circlePath2);
    // Set the clip to be the intersection of the circle and the square
    ctx.clip(squarePath2);
    // Draw stuff that gets clipped
    ctx.fillStyle = [0, 0, 0xff];
    ctx.fillRect(0, 0, w, h);
    ctx2.putImageData(imData, 0, 0);
}

drawLine(20, 20, 80, 100, 1);
drawLine(20, 20, 80, 100, 0.5);
drawGradientLine(6, 20, 120, 100, 20, [/*4, 10*/], 'square');
//drawGradientLine(30, 30, 100, 30, 20, [/*4, 10*/], 'round');
drawPolyline(60, 20, 20, 20, 20, 60, 20, [/*10, 10*/], 'butt', 'bevel');
drawPolyline(10, 10, 60, 10, 60, 60, 20, [], 'butt', 'bevel');
drawPolyline(20, 10, 20, 60, 60, 60, 20, [], 'butt', 'bevel');
drawPolyline(60, 10, 60, 60, 10, 60, 20, [], 'butt', 'bevel');
drawPolyline(70, 70, 40, 60, 20, 10, 20, [], 'butt', 'bevel');
drawPolyline(20, 10, 40, 60, 70, 70, 20, [], 'butt', 'bevel');
drawPolyline(20, 10, 40, 60, 10, 70, 20, [], 'butt', 'bevel');
drawPolyline(20, 70, 40, 10, 70, 60, 20, [], 'butt', 'bevel');
drawPolyline(20, 10, 40, 70, 70, 20, 20, [], 'butt', 'bevel');
drawPolyline(70, 20, 40, 70, 20, 10, 20, [], 'butt', 'bevel');
drawPolyline(60, 20, 20, 20, 20, 60, 20, [], 'butt', 'miter');
drawPolyline(10, 10, 60, 10, 60, 60, 20, [], 'butt', 'miter');
drawPolyline(20, 10, 20, 60, 60, 60, 20, [], 'butt', 'miter');
drawPolyline(60, 10, 60, 60, 10, 60, 20, [], 'butt', 'miter');
drawPolyline(70, 70, 40, 60, 20, 10, 20, [], 'butt', 'miter');
drawPolyline(20, 10, 40, 60, 70, 70, 20, [], 'butt', 'miter');
drawPolyline(20, 10, 40, 60, 10, 70, 20, [], 'butt', 'miter');
drawPolyline(20, 70, 40, 20, 70, 60, 20, [], 'butt', 'miter');
drawPolyline(20, 10, 40, 70, 70, 20, 20, [], 'butt', 'miter');
drawPolyline(70, 20, 40, 70, 20, 10, 20, [], 'butt', 'miter');
drawPolyline(10, 10, 15, 70, 25, 10, 20, [], 'butt', 'miter', 100);
drawPolyline(10, 10, 15, 70, 25, 10, 20, [], 'butt', 'miter', 1);
drawGradientCircles();
drawArcTo();
drawArcs(4, 1, -Math.PI/4);
drawBeziers([10, 10, 200, 100, 10, 100, 70, 10], -Math.PI/4);
drawRoundRect();
drawGradientArc(50, 50, 20, 40, 30*Math.PI/180, 1, Math.PI/2, false, 2, [], 'butt', 'bevel');
drawGradientArc(50, 50, 20, 40, 30*Math.PI/180, 1, Math.PI/2, true, 2, [], 'butt', 'bevel');
drawGradientBezier([10, 10, 200, 100, 10, 100, 70, 10], 4, [], 'butt', 'bevel');
fillGradientBezier([10, 10, 200, 100, 10, 100, 70, 10], 'nonzero');
fillGradientBezier([10, 10, 200, 100, 10, 100, 70, 10], 'evenodd');
fillGradientDisk(50, 50, 10, 40, 'nonzero', true);
fillGradientDisk(50, 50, 10, 40, 'evenodd', true);
fillGradientDisk(50, 50, 10, 40, 'nonzero', false);
fillGradientDisk(50, 50, 10, 40, 'evenodd', false);
clip();
})();
</script>
</body></html>
